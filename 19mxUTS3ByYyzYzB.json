{
  "active": true,
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Postgres - Obtener Lead y Historial": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Postgres - Crear Lead Nuevo": {
      "main": [
        [
          {
            "node": "Execute a SQL query",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory1": {
      "ai_memory": [
        [
          {
            "node": "AI Agent - Conversacional",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Tool - Update Lead Stage": {
      "ai_tool": [
        [
          {
            "node": "AI Agent - Conversacional",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "update_lead_data": {
      "ai_tool": [
        []
      ]
    },
    "Tool - Send Alert Email": {
      "ai_tool": [
        []
      ]
    },
    "IF - Lead no es Nuevo": {
      "main": [
        [
          {
            "node": "Execute a SQL query",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Postgres - Crear Lead Nuevo",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "IF - Lead no es Nuevo",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Select rows from a table in Postgres": {
      "ai_tool": [
        []
      ]
    },
    "Execute a SQL query": {
      "main": [
        [
          {
            "node": "AI Agent - Conversacional",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent - Conversacional",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent - Conversacional": {
      "main": [
        [
          {
            "node": "Enviar texto",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Enviar texto": {
      "main": [
        [
          {
            "node": "Call 'WORKFLOW 2 - Agente de Calificaci√≥n'",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Call 'WORKFLOW 2 - Agente de Calificaci√≥n'": {
      "main": [
        []
      ]
    },
    "Supabase Vector Store": {
      "ai_tool": [
        [
          {
            "node": "AI Agent - Conversacional",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI": {
      "ai_embedding": [
        [
          {
            "node": "Supabase Vector Store",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Tool - cambiar nombre": {
      "ai_tool": [
        [
          {
            "node": "AI Agent - Conversacional",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Tool - Update Pago_Es_Enviado": {
      "ai_tool": [
        [
          {
            "node": "AI Agent - Conversacional",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "es mandado por el cliente",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Mapear mensaje",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Transcribir audio": {
      "main": [
        [
          {
            "node": "Mapear mensaje",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mapear mensaje": {
      "main": [
        [
          {
            "node": "If2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch1": {
      "main": [
        [
          {
            "node": "Redis",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert to File": {
      "main": [
        [
          {
            "node": "Transcribir audio",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Obter m dia em base64": {
      "main": [
        [
          {
            "node": "Convert to File",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "es mandado por el cliente": {
      "main": [
        [
          {
            "node": "Obter m dia em base64",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Redis": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "Redis1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Redis1": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "pregunta_usuario",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation, do nothing",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "pregunta_usuario": {
      "main": [
        [
          {
            "node": "Redis2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [
          {
            "node": "Edit Fields1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If2": {
      "main": [
        [],
        [
          {
            "node": "Switch1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields1": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Redis2": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "Postgres - Obtener Lead y Historial",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-10-09T15:12:09.084Z",
  "id": "19mxUTS3ByYyzYzB",
  "isArchived": false,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "Calificaci√≥n Leads Osteopat√≠a  Atlas [CORREGIDO]",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "clinicas",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -3120,
        1424
      ],
      "id": "00114af6-a363-4782-a326-d4efead7b609",
      "name": "Webhook",
      "webhookId": "REDACTED"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT \n  session_id,\n  json_agg(\n    json_build_object(\n      'role', message->>'type',\n      'content', message->>'content'\n    ) ORDER BY id ASC\n  ) as conversation_history\nFROM n8n_chat_histories\nWHERE session_id = '{{ $('Edit Fields1').item.json.chat_id }}'\nGROUP BY session_id;\n",
        "options": {}
      },
      "id": "837053aa-5e85-43db-bdaf-bd9c20f4d271",
      "name": "Postgres - Obtener Lead y Historial",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2,
      "position": [
        320,
        1392
      ],
      "credentials": {}
    },
    {
      "parameters": {
        "schema": {
          "__rl": true,
          "value": "public",
          "mode": "list",
          "cachedResultName": "public"
        },
        "table": {
          "__rl": true,
          "value": "leads",
          "mode": "list",
          "cachedResultName": "leads"
        },
        "dataMode": "defineBelow",
        "valuesToSend": {
          "values": [
            {
              "column": "nombre",
              "value": "={{ $('Webhook').item.json.body.data.pushName }}"
            },
            {
              "column": "telefono",
              "value": "={{ $('Webhook').item.json.body.data.key.remoteJid }}"
            },
            {
              "column": "mensaje_inicial",
              "value": "={{ $('Webhook').item.json.body.data.message.conversation }}"
            },
            {
              "column": "conversation_stage",
              "value": "0"
            },
            {
              "column": "score",
              "value": "0"
            },
            {
              "column": "clasificacion",
              "value": "Fr√≠o"
            }
          ]
        },
        "options": {}
      },
      "id": "22691fb1-44d3-4c8e-ba43-e09f94ebd496",
      "name": "Postgres - Crear Lead Nuevo",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2,
      "position": [
        800,
        1568
      ],
      "executeOnce": false,
      "alwaysOutputData": true,
      "credentials": {}
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Webhook').item.json.body.data.key.remoteJid }}"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        1008,
        1968
      ],
      "id": "f5c41d1c-0889-4c2e-830d-afe68876e06c",
      "name": "Postgres Chat Memory1",
      "credentials": {}
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "leads",
          "mode": "list",
          "cachedResultName": "leads"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "conversation_stage": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conversation_stage', ``, 'number') }}",
            "telefono": "={{ $('Webhook').item.json.body.data.key.remoteJid }}"
          },
          "matchingColumns": [
            "telefono"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "nombre",
              "displayName": "nombre",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "telefono",
              "displayName": "telefono",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "email",
              "displayName": "email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "mensaje_inicial",
              "displayName": "mensaje_inicial",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "clasificacion",
              "displayName": "clasificacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "problema_principal",
              "displayName": "problema_principal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "intentos_contacto",
              "displayName": "intentos_contacto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "ultima_interaccion",
              "displayName": "ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "ultimo_mensaje",
              "displayName": "ultimo_mensaje",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "necesita_llamada",
              "displayName": "necesita_llamada",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "conversation_stage",
              "displayName": "conversation_stage",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true
            },
            {
              "id": "score",
              "displayName": "score",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "urgencia",
              "displayName": "urgencia",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Pago_Es_Enviado",
              "displayName": "Pago_Es_Enviado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgresTool",
      "typeVersion": 2.6,
      "position": [
        1296,
        1984
      ],
      "id": "1617382b-835f-4edb-ba03-eabde5fab80d",
      "name": "Tool - Update Lead Stage",
      "credentials": {}
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "leads",
          "mode": "list",
          "cachedResultName": "leads"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "necesita_llamada": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('necesita_llamada', ``, 'boolean') }}",
            "id": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('id__using_to_match_', ``, 'number') }}",
            "intentos_contacto": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('intentos_contacto', ``, 'number') }}",
            "conversation_stage": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conversation_stage', ``, 'number') }}",
            "nombre": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('nombre', ``, 'string') }}",
            "telefono": "={{ $('Webhook').item.json.body.data.key.remoteJid }}",
            "email": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('email', ``, 'string') }}",
            "mensaje_inicial": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('mensaje_inicial', ``, 'string') }}",
            "fuente": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('fuente', ``, 'string') }}",
            "estado": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('estado', ``, 'string') }}",
            "clasificacion": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('clasificacion', ``, 'string') }}",
            "razon_clasificacion": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('razon_clasificacion', ``, 'string') }}",
            "problema_principal": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('problema_principal', ``, 'string') }}",
            "ultima_interaccion": "={{ $now }}",
            "ultimo_mensaje": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('ultimo_mensaje', ``, 'string') }}",
            "created_at": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('created_at', ``, 'string') }}",
            "updated_at": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('updated_at', ``, 'string') }}",
            "score": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('score', ``, 'number') }}",
            "urgencia": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('urgencia', ``, 'string') }}"
          },
          "matchingColumns": [
            "telefono"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "nombre",
              "displayName": "nombre",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "telefono",
              "displayName": "telefono",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "email",
              "displayName": "email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "mensaje_inicial",
              "displayName": "mensaje_inicial",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "fuente",
              "displayName": "fuente",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "fecha_captacion",
              "displayName": "fecha_captacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "estado",
              "displayName": "estado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "clasificacion",
              "displayName": "clasificacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "razon_clasificacion",
              "displayName": "razon_clasificacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "problema_principal",
              "displayName": "problema_principal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "intentos_contacto",
              "displayName": "intentos_contacto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true
            },
            {
              "id": "ultima_interaccion",
              "displayName": "ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true
            },
            {
              "id": "ultimo_mensaje",
              "displayName": "ultimo_mensaje",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "necesita_llamada",
              "displayName": "necesita_llamada",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true
            },
            {
              "id": "created_at",
              "displayName": "created_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true
            },
            {
              "id": "updated_at",
              "displayName": "updated_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true
            },
            {
              "id": "conversation_stage",
              "displayName": "conversation_stage",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true
            },
            {
              "id": "score",
              "displayName": "score",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "urgencia",
              "displayName": "urgencia",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgresTool",
      "typeVersion": 2.6,
      "position": [
        1616,
        1952
      ],
      "id": "682a988a-bbd6-47fb-94b9-ffd0c6c29355",
      "name": "update_lead_data",
      "credentials": {}
    },
    {
      "parameters": {
        "sendTo": "idrabde0@gmail.com",
        "subject": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Subject', ``, 'string') }}",
        "message": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Message', ``, 'string') }}",
        "options": {}
      },
      "type": "n8n-nodes-base.gmailTool",
      "typeVersion": 2.1,
      "position": [
        1936,
        1952
      ],
      "id": "63a4e4bf-e98b-46d6-8641-6e998f571de6",
      "name": "Tool - Send Alert Email",
      "webhookId": "REDACTED",
      "credentials": {}
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "PRUEBA PERSONAL",
        "remoteJid": "={{ $('Edit Fields').item.json.id_chat }}",
        "messageText": "={{ $('AI Agent - Conversacional').item.json.output }}",
        "options_message": {}
      },
      "type": "n8n-nodes-evolution-api.evolutionApi",
      "typeVersion": 1,
      "position": [
        1888,
        1376
      ],
      "id": "5fcd4b32-afa0-4e02-beea-b5e109cb7268",
      "name": "Enviar texto",
      "credentials": {}
    },
    {
      "parameters": {
        "conditions": {
          "number": [
            {
              "value1": "={{ $('Postgres - Obtener Lead y Historial').item.json.conversation_history.length }}",
              "operation": "larger"
            }
          ]
        }
      },
      "id": "1c247b7c-0bef-41e8-8856-690b1d09fa0d",
      "name": "IF - Lead no es Nuevo",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        640,
        1392
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "6a2190c7-00ad-4345-ae74-44ff7fecf47f",
              "name": "todos_los_mensajes",
              "value": "={{ $json.conversation_history }}",
              "type": "string"
            },
            {
              "id": "df6a3001-023b-4230-9734-9d0bd40128ce",
              "name": "id_chat",
              "value": "={{ $('Webhook').item.json.body.data.key.remoteJid }}",
              "type": "string"
            },
            {
              "id": "ef0e8160-db9e-4288-b9f7-74e580d577a7",
              "name": "mensaje",
              "value": "={{ $('pregunta_usuario').item.json.response }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        480,
        1392
      ],
      "id": "117dcbe7-d3f5-484d-99e3-430d11f48d80",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "leads",
          "mode": "list",
          "cachedResultName": "leads"
        },
        "returnAll": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Return_All', ``, 'boolean') }}",
        "where": {
          "values": [
            {
              "column": "telefono",
              "value": "={{ $('Webhook').item.json.body.data.key.remoteJid }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgresTool",
      "typeVersion": 2.6,
      "position": [
        1776,
        1952
      ],
      "id": "96e4a06a-3cf7-4bba-b709-40a3efe8172d",
      "name": "Select rows from a table in Postgres",
      "credentials": {}
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT *\nFROM leads\nWHERE telefono = '{{ $(\"Webhook\").item.json.body.data.key.remoteJid }}';\n",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        976,
        1376
      ],
      "id": "3b40528f-bebd-445b-9609-21b11751cec3",
      "name": "Execute a SQL query",
      "credentials": {}
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4o",
          "mode": "list",
          "cachedResultName": "gpt-4o"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        1104,
        1600
      ],
      "id": "8419bd35-9695-48af-9154-02ae02f84f66",
      "name": "OpenAI Chat Model",
      "credentials": {}
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('Edit Fields').item.json.mensaje }}",
        "options": {
          "systemMessage": "=# AGENTE DE CONVERSACI√ìN - OSTEOPAT√çA\n\n## üéØ TU ROL\nEres un asistente virtual emp√°tico y profesional de una cl√≠nica de osteopat√≠a. Tu √öNICA misi√≥n es:\n1. **Mantener una conversaci√≥n natural** con el paciente  \n2. **Recopilar informaci√≥n clave** de forma sutil (problema, tiempo, intenci√≥n)  \n3. **Responder preguntas usando la base de conocimiento** (horarios, precios, ubicaci√≥n)  \n4. **Continuar la conversaci√≥n** si el usuario pregunta algo m√°s  \n5. **NO tomas decisiones de calificaci√≥n** (eso lo hace otro agente)\n\n---\n\n## üìã INFORMACI√ìN DEL USUARIO\nNombre:\nTel√©fono: {{ $json.telefono }}\n\n---\n\n## üóÑÔ∏è BASE DE CONOCIMIENTO DISPONIBLE\n\n**Tienes acceso a informaci√≥n del centro mediante la herramienta `Supabase Vector Store`.**\n\nUsa esta tool cuando el usuario pregunte sobre:\n- üìç Ubicaci√≥n y direcci√≥n  \n- üïê Horarios de atenci√≥n  \n- üí∂ Precios y tarifas  \n- üè• Servicios disponibles  \n- üë®‚Äç‚öïÔ∏è Especialistas  \n- üìû Formas de contacto  \n- ‚ôø Accesibilidad  \n- üÖøÔ∏è Parking  \n- y mas cosas\n\n**IMPORTANTE:** Antes de inventar informaci√≥n, **SIEMPRE consulta primero** la base vectorial usando la tool `Supabase Vector Search` con la pregunta del usuario.\n\n---\n\n## üí¨ FLUJO DE CONVERSACI√ìN\n\n### 1Ô∏è‚É£ PRIMER CONTACTO\n¬°Hola! üëã Gracias por contactarnos.\n\nSoy tu asistente virtual. Cu√©ntame, ¬øqu√© molestia o dolor te trae hoy?\n**Usa la tool 'Tool - Update Lead Stage' y cambia conversation_stage a 1.**\n\n\n### 2Ô∏è‚É£ IDENTIFICAR PROBLEMA\nEntiendo, [problema].\n\n¬øHace cu√°nto tiempo tienes esta molestia? (d√≠as, semanas, meses)\n**Usa la tool 'Tool - Update Lead Stage' y cambia conversation_stage a 2.**\n\n\n### 3Ô∏è‚É£ EVALUAR TIEMPO\nGracias por la informaci√≥n.\n\n¬øYa has considerado buscar una soluci√≥n profesional, o de momento solo buscas informaci√≥n?\n**Usa la tool 'Tool - Update Lead Stage' y cambia conversation_stage a 3.**\n\n### 4Ô∏è‚É£ Mandar enlace de pago a los clientes calientes\n\n¬°Excelente! Por la urgencia y el inter√©s que has mostrado, te recomiendo la Evaluaci√≥n Inicial en Promoci√≥n. Cuesta solo 45‚Ç¨ y te dar√° un diagn√≥stico preciso. Puedes reservar tu hora y pagar de forma segura aqu√≠:üëâ https://apposteopatiaatlas.viday.es/reserva\n**M√°nda el enlace as√≠ tal cual sin meter corchetes ni par√©ntesis**\nüìå Importante: Si despu√©s decides contratar uno de nuestros packs de tratamiento, descontaremos el precio de esta evaluaci√≥n inicial del total del programa.\n**mandale el mensaje entero con el enlace para que agende**\n**Usa la tool 'Tool - Update Lead Stage' y cambia conversation_stage a 4.**\n**Usa la tool 'Tool - Update Pago_Es_Enviado' y c√°mbialo a true.**\n\n---\n## üîÄ MANEJO DE INTERRUPCIONES EN EL FLUJO\n\n**‚ö†Ô∏è REGLA CR√çTICA: Si el usuario hace una pregunta DURANTE el proceso de recopilaci√≥n de los 3 datos clave (problema, tiempo, intenci√≥n), DEBES:**\n\n1. **PAUSA** el flujo actual\n2. **RESPONDE** su pregunta de forma breve (consultando `Supabase Vector Search` si es necesario)\n3. **RETOMA EXACTAMENTE** la √∫ltima pregunta pendiente del flujo de recopilaci√≥n\n4. **NO hagas preguntas nuevas** - solo retoma la pregunta que qued√≥ sin responder\n\n### üìù EJEMPLOS DE INTERRUPCI√ìN:\n\n**EJEMPLO 1 - Interrupci√≥n en Stage 2 (pregunta de tiempo):**\n\nT√∫: \"Entiendo, dolor de cabeza. ¬øHace cu√°nto tiempo tienes esta molestia?\"\n\nUsuario: \"¬øQu√© horario ten√©is?\"\n\n**‚úÖ RESPUESTA CORRECTA:**\nT√∫: [Consultas Supabase Vector Search: \"horarios de atenci√≥n\"]\n\"Nuestros horarios son de lunes a viernes de 9:00 a 20:00h y s√°bados de 10:00 a 14:00h.\n\nVolviendo a tu dolor de cabeza, ¬øhace cu√°nto tiempo tienes esta molestia?\"\n\n**‚ùå RESPUESTA INCORRECTA:**\n\"Nuestros horarios son... ¬øTienes preferencia de horario?\" ‚Üê NO hagas preguntas nuevas\n\n---\n\n**EJEMPLO 2 - Interrupci√≥n en Stage 3 (pregunta de intenci√≥n):**\n\nT√∫: \"Gracias por la informaci√≥n. ¬øYa has considerado buscar una soluci√≥n profesional, o de momento solo buscas informaci√≥n?\"\n\nUsuario: \"¬øCu√°nto cuesta?\"\n\n**‚úÖ RESPUESTA CORRECTA:**\nT√∫: [Consultas Supabase Vector Search: \"precios\"]\n\"La primera consulta cuesta 45‚Ç¨ y las sesiones siguientes 40‚Ç¨.\n\nVolviendo a tu caso, ¬øya has considerado buscar una soluci√≥n profesional o de momento solo buscas informaci√≥n?\"\n\n---\n\n### üéØ RECORDATORIO CLAVE:\n**Hasta que no tengas los 3 datos (problema + tiempo + intenci√≥n), NO cambies el flujo. Siempre retoma la pregunta pendiente despu√©s de resolver la interrupci√≥n.**\n\n---\n\n## üîÄ MANEJO DE PREGUNTAS ADICIONALES\n\n### üìÖ **Horarios/Citas:**\n1. Consulta `Supabase Vector Store` con la query: \"horarios de atenci√≥n\"\n2. Responde:\nClaro, nuestros horarios son [info de la base de datos].\n\n¬øTienes preferencia de horario para tu consulta?\n\n### üí∂ **Precios:**\n1. Consulta `Supabase Vector Search` con la query: \"precios tratamientos osteopat√≠a\"\n2. Responde:\nTenemos las siguientes tarifas:\n[info de la base de datos]\n\n¬øTe gustar√≠a que un especialista te explique las opciones para tu [problema]?\n\n\n### üìç **Ubicaci√≥n:**\n1. Consulta `Supabase Vector Search` con la query: \"direcci√≥n ubicaci√≥n centro\"\n2. Responde:\nEstamos ubicados en [direcci√≥n de la base de datos].\n\n¬øNecesitas indicaciones para llegar o informaci√≥n sobre parking?\n\n\n### üÖøÔ∏è **Parking/Transporte:**\nConsulta `Supabase Vector Search` con la query: \"parking transporte p√∫blico acceso\"  \nResponde con la informaci√≥n obtenida.\n\n### üè• **Servicios/Tratamientos:**\nConsulta `Supabase Vector Search` con la query: \"[tipo de tratamiento espec√≠fico]\"  \nResponde:\nPara [problema del usuario], ofrecemos [servicios de la base de datos].\n\n¬øTe gustar√≠a m√°s detalles sobre alg√∫n tratamiento en particular?\n\n\n### üë®‚Äç‚öïÔ∏è **Especialistas:**\nConsulta `Supabase Vector Search` con la query: \"equipo oste√≥patas especialistas\"  \nResponde con la informaci√≥n correspondiente.\n\n### ‚ùì **Dudas sobre el tratamiento:**\nEs normal tener dudas.\n\nPara tu caso espec√≠fico de [problema], lo mejor es que un oste√≥pata valore tu situaci√≥n. ¬øTe interesar√≠a una evaluaci√≥n inicial?\n\n\n### üîÑ **Si pide agendar directamente:**\n¬°Perfecto! Puedes reservar tu cita directamente aqu√≠:\nüëâ https://apposteopatiaatlas.viday.es/reserva\n**M√°nda el enlace as√≠ tal cual sin meter corchetes ni par√©ntesis**\n\nUna vez confirmada tu reserva, te llegar√° un mensaje con los detalles de tu cita. ¬øHay algo m√°s en lo que pueda ayudarte?\n\n\n### ü§∑ **Si no encuentras informaci√≥n en la base:**\nD√©jame consultar eso con el equipo.\n\nUn especialista te contactar√° pronto con esa informaci√≥n. Mientras tanto, ¬øhay algo m√°s en lo que pueda ayudarte?\n\n\n---\n\n## ‚úÖ REGLAS DE ORO\n\n### Comunicaci√≥n:\n- **Brevedad:** M√°ximo 3 l√≠neas por mensaje  \n- **Una pregunta a la vez**  \n- **Tono c√°lido pero profesional**  \n- **Usa emojis moderadamente** (1-2 por mensaje m√°ximo)\n\n### Uso de la Base de Conocimiento:\n- **SIEMPRE consulta** `Supabase Vector Search` antes de responder sobre info del centro  \n- **Parafrasea** la informaci√≥n obtenida  \n- **Si la base no tiene info**, admite que consultar√°s con el equipo humano\n\n### Continuidad:\n- No menciones puntuaci√≥n, stages ni clasificaciones  \n- Sigue conversando naturalmente si hacen preguntas adicionales  \n- No dejes la conversaci√≥n \"colgada\"  \n- Prioriza recopilar los 3 datos clave antes de extenderte\n\n---\n\n## üö´ NO HAGAS\n- ‚ùå Calificar leads  \n- ‚ùå Asignar puntuaciones  \n- ‚ùå Enviar links de pago directamente (excepto cuando soliciten agendar)  \n- ‚ùå Hablar de sistemas internos  \n- ‚ùå Hacer m√∫ltiples preguntas seguidas  \n- ‚ùå Inventar informaci√≥n o diagn√≥sticos m√©dicos\n\n---\n\n## üéØ OBJETIVO\n\n**FASE 1 - RECOPILACI√ìN**  \n1. ‚úÖ Problema espec√≠fico  \n2. ‚úÖ Tiempo de la molestia  \n3. ‚úÖ Intenci√≥n de compra  \n\n**FASE 2 - CONTINUIDAD**  \n- Si el usuario pregunta sobre el centro ‚Üí consulta `Supabase Vector Search`  \n- Si quiere agendar ‚Üí env√≠a enlace de reserva directa  \n\n**FASE 3 - HANDOFF**  \nLuego el **Agente de Calificaci√≥n** tomar√° el control para:\n- Calcular score  \n- Enviar ofertas o links de pago  \n- Alertar al equipo  \n\n---\n\n## üîß HERRAMIENTAS DISPONIBLES\n\n### `Supabase Vector Search`\n**Cu√°ndo usar:** Cuando el usuario pregunte sobre el centro.  \n**C√≥mo usar:** Env√≠a la query con la pregunta del usuario.  \n\nEjemplo:\n- Usuario: \"¬øCu√°nto cuesta una sesi√≥n?\"\n- Acci√≥n: Ejecutar b√∫squeda con \"precio sesi√≥n osteopat√≠a\".\n\n---\n\n## üí° EJEMPLO DE CONVERSACI√ìN COMPLETA\nUsuario: Hola\nT√∫: ¬°Hola! üëã Gracias por contactarnos. Soy tu asistente virtual. Cu√©ntame, ¬øqu√© molestia o dolor te trae hoy?\n\nUsuario: Me duele la espalda baja\nT√∫: Entiendo, dolor de espalda baja. ¬øHace cu√°nto tiempo tienes esta molestia?\n\nUsuario: Como 2 semanas\nT√∫: Gracias por la informaci√≥n. ¬øYa has considerado buscar una soluci√≥n profesional, o solo buscas informaci√≥n?\n\nUsuario: S√≠ busco soluci√≥n, cu√°nto cuesta?\nT√∫: [Consultas Supabase Vector Search: \"precio sesi√≥n osteopat√≠a\"]\nNuestras tarifas son:\n- Primera consulta: 45‚Ç¨\n- Sesiones siguientes: 40‚Ç¨\n¬øTe gustar√≠a agendar una evaluaci√≥n inicial?\n\nUsuario: S√≠, c√≥mo agendo?\nT√∫: ¬°Perfecto! Puedes reservar tu cita directamente aqu√≠:\nüëâ https://apposteopatiaatlas.viday.es/reserva\n\nUna vez confirmada tu reserva, te llegar√° un mensaje con los detalles. ¬øHay algo m√°s en lo que pueda ayudarte?\n\nUsuario: No gracias\nT√∫: ¬°Genial! Nos vemos pronto en tu cita. ¬°Hasta pronto! üëã\n\n\n---\n## üö´ L√çMITES DE CONTEXTO DEL NEGOCIO\n\n**SOLO respondes preguntas relacionadas con:**\n- Osteopat√≠a, fisioterapia y tratamientos corporales\n- Dolores musculares, articulares o posturales\n- Servicios, precios y disponibilidad de citas\n- Ubicaci√≥n, horarios y formas de contacto del consultorio\n\n**NO respondes preguntas sobre:**\n- ‚ùå Conocimientos generales (capitales, historia, geograf√≠a)\n- ‚ùå Temas acad√©micos (matem√°ticas, ciencias, literatura)\n- ‚ùå Entretenimiento (pel√≠culas, m√∫sica, deportes)\n- ‚ùå Tecnolog√≠a no relacionada con citas/pagos\n- ‚ùå Pol√≠tica, religi√≥n o temas controversiales\n- ‚ùå Cualquier tema fuera del √°mbito de salud musculoesquel√©tica\n\n### RESPUESTA EST√ÅNDAR PARA PREGUNTAS FUERA DE CONTEXTO:\n\"Disculpa, soy un asistente especializado en osteopat√≠a y solo puedo ayudarte con temas relacionados con tu salud musculoesquel√©tica, agendar citas o informaci√≥n sobre nuestros servicios. ¬øTienes alguna molestia f√≠sica que quieras consultarme? üòä\"\n\n**Mant√©n el foco:** Si el usuario insiste en temas ajenos, redirige amablemente hacia tu expertise sin ser repetitivo.\n\n## üéì RECORDATORIOS FINALES\n1. Prioriza los 3 datos clave primero  \n2. Si preguntan algo urgente, responde y luego retoma el flujo  \n3. Usa `Supabase Vector Search` para toda la info del centro  \n4. Mant√©n tono natural  \n5. Cuando alguien quiera agendar, env√≠a el enlace de reserva directa  \n6. Cierra confirmando si tienen m√°s preguntas antes de finalizar\n----\n\nLa fecha de hoy es {{ $('Code in JavaScript').item.json.fechaActual }}"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        1280,
        1376
      ],
      "id": "b27f7e9a-b7df-4f74-9e72-c6002714771b",
      "name": "AI Agent - Conversacional"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "25pwi6ochPPPTiNZ",
          "mode": "list",
          "cachedResultUrl": "/workflow/25pwi6ochPPPTiNZ",
          "cachedResultName": "AI Agent - Calificaci√≥n Leads Osteopat√≠a subworkflow"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "Chat_Id": "={{ $('Edit Fields').item.json.id_chat }}",
            "Mensaje_actual": "={{ $('Edit Fields').item.json.mensaje }}",
            "nombre": "={{ $('Execute a SQL query').item.json.nombre }}",
            "respuesta_agente": "={{ $('AI Agent - Conversacional').item.json.output }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "Mensaje_actual",
              "displayName": "Mensaje_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "Chat_Id",
              "displayName": "Chat_Id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "nombre",
              "displayName": "nombre",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "respuesta_agente",
              "displayName": "respuesta_agente",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            }
          ],
          "attemptToConvertTypes": true,
          "convertFieldsToString": true
        },
        "options": {
          "waitForSubWorkflow": true
        }
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        2320,
        1376
      ],
      "id": "92aea6c0-1444-4214-ade0-1a8b01194866",
      "name": "Call 'WORKFLOW 2 - Agente de Calificaci√≥n'"
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolDescription": "Base de datos de un centro de osteopat√≠a que gestiona informaci√≥n del centro, servicios, terapeutas, clientes, citas, pagos y rese√±as para facilitar agendamiento y administraci√≥n autom√°tica. Permite consultas r√°pidas y seguimiento integral de pacientes y tratamientos.",
        "tableName": {
          "__rl": true,
          "value": "documents",
          "mode": "list",
          "cachedResultName": "documents"
        },
        "topK": 50,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        1520,
        1600
      ],
      "id": "1ffa937b-a12d-469e-8ec2-52cd7ede117b",
      "name": "Supabase Vector Store",
      "credentials": {}
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        1744,
        1776
      ],
      "id": "664d9957-e883-4bef-abe9-54a992f9741b",
      "name": "Embeddings OpenAI",
      "credentials": {}
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "leads",
          "mode": "list",
          "cachedResultName": "leads"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telefono": "={{ $('Webhook').item.json.body.data.key.remoteJid }}",
            "nombre": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('nombre', ``, 'string') }}"
          },
          "matchingColumns": [
            "telefono"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "nombre",
              "displayName": "nombre",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "telefono",
              "displayName": "telefono",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "email",
              "displayName": "email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "mensaje_inicial",
              "displayName": "mensaje_inicial",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "clasificacion",
              "displayName": "clasificacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "problema_principal",
              "displayName": "problema_principal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "intentos_contacto",
              "displayName": "intentos_contacto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "ultima_interaccion",
              "displayName": "ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "ultimo_mensaje",
              "displayName": "ultimo_mensaje",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "necesita_llamada",
              "displayName": "necesita_llamada",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "conversation_stage",
              "displayName": "conversation_stage",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "score",
              "displayName": "score",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "urgencia",
              "displayName": "urgencia",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Pago_Es_Enviado",
              "displayName": "Pago_Es_Enviado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgresTool",
      "typeVersion": 2.6,
      "position": [
        1184,
        1968
      ],
      "id": "5508e21d-abb1-43fb-ba6f-38d6aa7d463c",
      "name": "Tool - cambiar nombre",
      "credentials": {}
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "leads",
          "mode": "list",
          "cachedResultName": "leads"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telefono": "={{ $('Webhook').item.json.body.data.key.remoteJid }}",
            "Pago_Es_Enviado": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Pago_Es_Enviado', ``, 'boolean') }}"
          },
          "matchingColumns": [
            "telefono"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "nombre",
              "displayName": "nombre",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "telefono",
              "displayName": "telefono",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "email",
              "displayName": "email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "mensaje_inicial",
              "displayName": "mensaje_inicial",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "clasificacion",
              "displayName": "clasificacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "problema_principal",
              "displayName": "problema_principal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "intentos_contacto",
              "displayName": "intentos_contacto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "ultima_interaccion",
              "displayName": "ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "ultimo_mensaje",
              "displayName": "ultimo_mensaje",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "necesita_llamada",
              "displayName": "necesita_llamada",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "conversation_stage",
              "displayName": "conversation_stage",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "score",
              "displayName": "score",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "urgencia",
              "displayName": "urgencia",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Pago_Es_Enviado",
              "displayName": "Pago_Es_Enviado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgresTool",
      "typeVersion": 2.6,
      "position": [
        1440,
        1968
      ],
      "id": "7137e5e1-0f6a-45fc-b94d-0f291f69283e",
      "name": "Tool - Update Pago_Es_Enviado",
      "credentials": {}
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Webhook').item.json.body.data.message.audioMessage.mimetype }}",
                    "rightValue": "=audio/ogg; codecs=opus",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "be9dbcd5-0882-4ce9-9822-305865fae492"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Audio"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "6a0ec742-7f93-4ea1-af39-35d410da1c1a",
                    "leftValue": "={{ $('Webhook').item.json.body.data.messageType }}",
                    "rightValue": "conversation",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Texto"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -1984,
        1424
      ],
      "id": "52a45d0e-543c-49be-98ac-c1270ed7e271",
      "name": "Switch"
    },
    {
      "parameters": {
        "resource": "audio",
        "operation": "transcribe",
        "options": {
          "language": "es"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.8,
      "position": [
        -1808,
        1184
      ],
      "id": "e9392468-8eff-427b-81a3-858301d66a6c",
      "name": "Transcribir audio",
      "credentials": {},
      "notes": "los audios estan en espa√±ol"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "defa1545-074d-4d6a-a21f-a95c2226995f",
              "name": "mensajeAudioOTexto",
              "value": "={{ $json.text || $('Webhook').item.json.body.data.message.conversation}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1728,
        1424
      ],
      "id": "c0b24134-5d52-4e04-9072-e33fb3ee74aa",
      "name": "Mapear mensaje"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Mapear mensaje').item.json.mensajeAudioOTexto }}",
                    "rightValue": "[null]",
                    "operator": {
                      "type": "string",
                      "operation": "notEquals"
                    },
                    "id": "ea1ce058-1302-4e81-9680-f70a12960a82"
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -1296,
        1408
      ],
      "id": "907c6dc8-fb87-4da2-954b-0eb0875982d0",
      "name": "Switch1"
    },
    {
      "parameters": {
        "operation": "toBinary",
        "sourceProperty": "data.base64",
        "options": {
          "mimeType": "audio/mp3"
        }
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        -2048,
        1184
      ],
      "id": "ab65d83e-975c-4ee6-861b-37f06c6680cd",
      "name": "Convert to File"
    },
    {
      "parameters": {
        "resource": "chat-api",
        "operation": "get-media-base64",
        "instanceName": "PRUEBA PERSONAL",
        "messageId": "={{ $('Webhook').item.json.body.data.key.id }}"
      },
      "type": "n8n-nodes-evolution-api.evolutionApi",
      "typeVersion": 1,
      "position": [
        -2368,
        1168
      ],
      "id": "b209b12a-b88e-400f-929c-cf3fcf27fde0",
      "name": "Obter m dia em base64",
      "credentials": {}
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Webhook').item.json.body.data.key.fromMe.toString() }}",
                    "rightValue": "=false",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "84f1ac15-47a9-4f36-b8b0-73ea0edc3ecc"
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -2592,
        1184
      ],
      "id": "eb59d0c5-c509-4c7f-b85f-62041c35cbd6",
      "name": "es mandado por el cliente"
    },
    {
      "parameters": {
        "operation": "push",
        "list": "={{ $('Edit Fields1').item.json.chat_id }}",
        "messageData": "={{ $json.mensajeAudioOTexto }}",
        "tail": true
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -1088,
        1408
      ],
      "id": "dbbb10ad-8479-4b09-b727-ffbb3b04f70b",
      "name": "Redis",
      "credentials": {}
    },
    {
      "parameters": {
        "amount": 15
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -864,
        1408
      ],
      "id": "40b11bbd-7d3e-40fe-b025-fd076c932e35",
      "name": "Wait",
      "webhookId": "REDACTED"
    },
    {
      "parameters": {
        "operation": "get",
        "propertyName": "message",
        "key": "={{ $('Edit Fields1').item.json.chat_id }}",
        "options": {}
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -672,
        1408
      ],
      "id": "8be63840-b43a-4ab1-b029-eb61fdba062d",
      "name": "Redis1",
      "credentials": {}
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "8ac5729a-0f8a-4564-b4f9-dd5e1fcb4c05",
              "leftValue": "={{ $json.message.last() }}",
              "rightValue": "={{ $('Mapear mensaje').item.json.mensajeAudioOTexto }}",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -448,
        1408
      ],
      "id": "83d2f02b-046e-4609-955d-3e7721e925fd",
      "name": "If"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        -144,
        1712
      ],
      "id": "5e5bfe3d-b822-4b2d-898d-2f105140363c",
      "name": "No Operation, do nothing"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "4a46e63b-2ead-4f35-aaa2-ab4ef5fc69f2",
              "name": "response",
              "value": "={{ $('Redis1').item.json.message.join() }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -160,
        1392
      ],
      "id": "8a6f7990-1a76-451d-888d-840bc46e9700",
      "name": "pregunta_usuario"
    },
    {
      "parameters": {
        "operation": "delete",
        "key": "={{ $('Edit Fields1').item.json.chat_id }}"
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        0,
        1392
      ],
      "id": "60cec49a-e0b0-4dd0-baee-a7a043e380ab",
      "name": "Redis2",
      "credentials": {}
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "641c492a-2026-49ba-81d8-31d19976fd99",
              "leftValue": "={{ $json.body.data.key.fromMe.toString() }}",
              "rightValue": "false",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -2816,
        1424
      ],
      "id": "58f1ae2b-b2f4-4397-9cfe-6c15ae1faef0",
      "name": "If1"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "62cf7f96-e1f3-4350-850c-548e2291ed79",
              "leftValue": "={{ $('Webhook').item.json.body.data.key.remoteJid }}",
              "rightValue": "34641750559@s.whatsapp.net",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -1520,
        1408
      ],
      "id": "5144f452-8c35-47d3-ba46-9d269e4b6136",
      "name": "If2"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "04868508-eb27-4b67-9dae-c883d48466d4",
              "name": "chat_id",
              "value": "={{ $json.body.data.key.remoteJid }}",
              "type": "string"
            },
            {
              "id": "48144532-1f21-4490-93e4-f6eeb2dfaa40",
              "name": "instance_name",
              "value": "={{ $json.body.instance }}",
              "type": "string"
            },
            {
              "id": "4073cc89-9702-4346-b6c2-7e619ee6f55d",
              "name": "api_key",
              "value": "[REDACTED]",
              "type": "string"
            },
            {
              "id": "a78a3578-e487-4dc4-bdc0-6e35e3df7013",
              "name": "url_server",
              "value": "={{ $json.body.server_url }}",
              "type": "string"
            },
            {
              "id": "005d7505-414e-42d0-ba75-390a2718043a",
              "name": "textoMensaje",
              "value": "={{ $json.body.data.message.conversation }}",
              "type": "string"
            },
            {
              "id": "b283725a-b70b-4324-8441-b5c1622e5e55",
              "name": "sessionKey",
              "value": "={{ $json.body.data.key.remoteJid }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -2416,
        1408
      ],
      "id": "b76b4ad9-c615-400e-8031-5c677d0debd5",
      "name": "Edit Fields1"
    },
    {
      "parameters": {
        "jsCode": "// Obtener fecha actual en zona horaria de Madrid\nconst ahora = new Date();\n\n// Convertir a zona horaria de Madrid (Europe/Madrid)\nconst fechaMadrid = new Date(ahora.toLocaleString('en-US', { timeZone: 'Europe/Madrid' }));\n\n// Arrays en espa√±ol\nconst diasSemana = ['domingo', 'lunes', 'martes', 'mi√©rcoles', 'jueves', 'viernes', 's√°bado'];\nconst meses = ['enero', 'febrero', 'marzo', 'abril', 'mayo', 'junio', \n               'julio', 'agosto', 'septiembre', 'octubre', 'noviembre', 'diciembre'];\n\n// Extraer componentes de la fecha en Madrid\nconst diaSemana = diasSemana[fechaMadrid.getDay()];\nconst dia = fechaMadrid.getDate();\nconst mes = meses[fechaMadrid.getMonth()];\nconst anio = fechaMadrid.getFullYear();\nconst hora = String(fechaMadrid.getHours()).padStart(2, '0');\nconst minutos = String(fechaMadrid.getMinutes()).padStart(2, '0');\n\n// Construir la fecha en formato espa√±ol completo\nconst fechaActual = diaSemana + ' ' + dia + ' de ' + mes + ' de ' + anio + ', ' + hora + ':' + minutos;\n\n// Retornar el resultado\nreturn {\n  fechaActual: fechaActual\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        176,
        1392
      ],
      "id": "961b24e6-1a52-46e7-bcdf-5172947ff13f",
      "name": "Code in JavaScript"
    }
  ],
  "origin": "n8n",
  "pinData": {
    "Webhook": [
      {
        "json": {
          "headers": {
            "host": "personal-n8n.rk9l1c.easypanel.host",
            "user-agent": "axios/1.7.9",
            "content-length": "11504",
            "accept-encoding": "gzip, compress, deflate, br",
            "content-type": "application/json",
            "x-forwarded-for": "172.18.0.1",
            "x-forwarded-host": "personal-n8n.rk9l1c.easypanel.host",
            "x-forwarded-port": "443",
            "x-forwarded-proto": "https",
            "x-forwarded-server": "7151fca3abb0",
            "x-real-ip": "172.18.0.1"
          },
          "params": {},
          "query": {},
          "body": {
            "event": "messages.upsert",
            "instance": "PRUEBA PERSONAL",
            "data": {
              "key": {
                "remoteJid": "34612575083@s.whatsapp.net",
                "fromMe": false,
                "id": "ACEDE8FD068741C36E680C828FC0CA4D"
              },
              "pushName": "Abde",
              "status": "DELIVERY_ACK",
              "message": {
                "audioMessage": {
                  "url": "https://mmg.whatsapp.net/v/t62.7117-24/535648143_1775320143123329_7815904993393216988_n.enc?ccb=11-4&oh=01_Q5Aa2wEI7Z6JS1g3L-jjjP3gV7wSyVl_d6FxQksD03Rw2zVfOQ&oe=692D4A9F&_nc_sid=5e03e0&mms3=true",
                  "mimetype": "audio/ogg; codecs=opus",
                  "fileSha256": "yxlsgntWjhtAK8K4N6s11uYxdM/IKiNaLIf1+2fSbRA=",
                  "fileLength": "7338",
                  "seconds": 3,
                  "ptt": true,
                  "mediaKey": "Zlo301Kgdewhff4PJEsnFa/W6On0Hbp8IJPk+UtNBCQ=",
                  "fileEncSha256": "dN1BPfmMrTh6hEgudnfeGWILug6JST1+BGvMD/YrsW8=",
                  "directPath": "/v/t62.7117-24/535648143_1775320143123329_7815904993393216988_n.enc?ccb=11-4&oh=01_Q5Aa2wEI7Z6JS1g3L-jjjP3gV7wSyVl_d6FxQksD03Rw2zVfOQ&oe=692D4A9F&_nc_sid=5e03e0",
                  "mediaKeyTimestamp": "1761991186",
                  "waveform": "AAAAAAMXAAAAAAAAAAAAAA4ZJzIzQTY8REFAQUA2Ni4XIzxHQzk8PjY7PDMxJC04MjI4Ojs+QjcnByYdDys3Mg=="
                },
                "messageContextInfo": {
                  "deviceListMetadata": {
                    "senderKeyHash": "kZgoUCTS5kVaZA==",
                    "senderTimestamp": "1761304559",
                    "recipientKeyHash": "DWFPamL5OaVyoA==",
                    "recipientTimestamp": "1761833417"
                  },
                  "deviceListMetadataVersion": 2,
                  "messageSecret": "pNh5c1ZqVOc6GVaN+RH3mFI6BGQJv4tV3r3RTSNKj+c="
                },
                "base64": "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"
              },
              "contextInfo": null,
              "messageType": "audioMessage",
              "messageTimestamp": 1761991188,
              "instanceId": "fba71333-3411-46bc-bc64-3fa83f57bca4",
              "source": "android"
            },
            "destination": "https://personal-n8n.rk9l1c.easypanel.host/webhook/clinicas",
            "date_time": "2025-11-01T06:59:49.163Z",
            "sender": "34641750559@s.whatsapp.net",
            "server_url": "https://personal-evolution-api.rk9l1c.easypanel.host",
            "apikey": "1EE52413CDCC-4D08-850B-74C22B50089B"
          },
          "webhookUrl": "https://personal-n8n.rk9l1c.easypanel.host/webhook/clinicas",
          "executionMode": "production"
        }
      }
    ]
  },
  "repo": {
    "owner": "abdeidr",
    "name": "n8n"
  },
  "settings": {
    "executionOrder": "v1"
  },
  "shared": [
    {
      "createdAt": "2025-10-09T15:12:09.102Z",
      "updatedAt": "2025-10-09T15:12:09.102Z",
      "role": "workflow:owner",
      "workflowId": "19mxUTS3ByYyzYzB",
      "projectId": "xdZYvePgLSibegaD"
    }
  ],
  "staticData": {
    "node:Schedule Cada 15 D√≠as": {
      "recurrenceRules": []
    },
    "node:Schedule Cada 24h": {
      "recurrenceRules": []
    }
  },
  "tags": [
    {
      "createdAt": "2025-10-09T21:39:05.855Z",
      "updatedAt": "2025-10-09T21:39:05.855Z",
      "id": "43cKumGAD19WIyyu",
      "name": "workflow 1-2"
    }
  ],
  "triggerCount": 1,
  "updatedAt": "2025-11-01T20:21:46.000Z",
  "versionId": "1e934a1b-8e2e-4f2c-b766-1d2175bf7cc1"
}