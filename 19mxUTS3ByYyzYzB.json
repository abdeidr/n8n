{
  "active": true,
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "Postgres - Obtener Lead y Historial",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Postgres - Obtener Lead y Historial": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Postgres - Crear Lead Nuevo": {
      "main": [
        [
          {
            "node": "Execute a SQL query",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory1": {
      "ai_memory": [
        [
          {
            "node": "AI Agent - Conversacional",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Tool - Update Lead Stage": {
      "ai_tool": [
        [
          {
            "node": "AI Agent - Conversacional",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "update_lead_data": {
      "ai_tool": [
        []
      ]
    },
    "Tool - Send Alert Email": {
      "ai_tool": [
        []
      ]
    },
    "IF - Lead no es Nuevo": {
      "main": [
        [
          {
            "node": "Execute a SQL query",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Postgres - Crear Lead Nuevo",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "IF - Lead no es Nuevo",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Select rows from a table in Postgres": {
      "ai_tool": [
        []
      ]
    },
    "Execute a SQL query": {
      "main": [
        [
          {
            "node": "AI Agent - Conversacional",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent - Conversacional",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent - Conversacional": {
      "main": [
        [
          {
            "node": "Enviar texto",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Enviar texto": {
      "main": [
        [
          {
            "node": "Call 'WORKFLOW 2 - Agente de Calificaci√≥n'",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Call 'WORKFLOW 2 - Agente de Calificaci√≥n'": {
      "main": [
        []
      ]
    },
    "Supabase Vector Store": {
      "ai_tool": [
        [
          {
            "node": "AI Agent - Conversacional",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI": {
      "ai_embedding": [
        [
          {
            "node": "Supabase Vector Store",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Tool - cambiar nombre": {
      "ai_tool": [
        [
          {
            "node": "AI Agent - Conversacional",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Tool - Update Pago_Es_Enviado": {
      "ai_tool": [
        [
          {
            "node": "AI Agent - Conversacional",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-10-09T15:12:09.084Z",
  "id": "19mxUTS3ByYyzYzB",
  "isArchived": false,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "Calificaci√≥n Leads Osteopat√≠a  Atlas [CORREGIDO]",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "clinicas",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        16,
        1392
      ],
      "id": "00114af6-a363-4782-a326-d4efead7b609",
      "name": "Webhook",
      "webhookId": "REDACTED"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT \n  session_id,\n  json_agg(\n    json_build_object(\n      'role', message->>'type',\n      'content', message->>'content'\n    ) ORDER BY id ASC\n  ) as conversation_history\nFROM n8n_chat_histories\nWHERE session_id = '{{ $json.body.data.key.remoteJid }}'\nGROUP BY session_id;\n",
        "options": {}
      },
      "id": "837053aa-5e85-43db-bdaf-bd9c20f4d271",
      "name": "Postgres - Obtener Lead y Historial",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2,
      "position": [
        224,
        1392
      ],
      "credentials": {}
    },
    {
      "parameters": {
        "schema": {
          "__rl": true,
          "value": "public",
          "mode": "list",
          "cachedResultName": "public"
        },
        "table": {
          "__rl": true,
          "value": "leads",
          "mode": "list",
          "cachedResultName": "leads"
        },
        "dataMode": "defineBelow",
        "valuesToSend": {
          "values": [
            {
              "column": "nombre",
              "value": "={{ $('Webhook').item.json.body.data.pushName }}"
            },
            {
              "column": "telefono",
              "value": "={{ $('Webhook').item.json.body.data.key.remoteJid }}"
            },
            {
              "column": "mensaje_inicial",
              "value": "={{ $('Webhook').item.json.body.data.message.conversation }}"
            },
            {
              "column": "conversation_stage",
              "value": "0"
            },
            {
              "column": "score",
              "value": "0"
            },
            {
              "column": "clasificacion",
              "value": "Fr√≠o"
            }
          ]
        },
        "options": {}
      },
      "id": "22691fb1-44d3-4c8e-ba43-e09f94ebd496",
      "name": "Postgres - Crear Lead Nuevo",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2,
      "position": [
        800,
        1568
      ],
      "executeOnce": false,
      "alwaysOutputData": true,
      "credentials": {}
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Webhook').item.json.body.data.key.remoteJid }}"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        1008,
        1968
      ],
      "id": "f5c41d1c-0889-4c2e-830d-afe68876e06c",
      "name": "Postgres Chat Memory1",
      "credentials": {}
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "leads",
          "mode": "list",
          "cachedResultName": "leads"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "conversation_stage": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conversation_stage', ``, 'number') }}",
            "telefono": "={{ $('Webhook').item.json.body.data.key.remoteJid }}"
          },
          "matchingColumns": [
            "telefono"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "nombre",
              "displayName": "nombre",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "telefono",
              "displayName": "telefono",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "email",
              "displayName": "email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "mensaje_inicial",
              "displayName": "mensaje_inicial",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "clasificacion",
              "displayName": "clasificacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "problema_principal",
              "displayName": "problema_principal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "intentos_contacto",
              "displayName": "intentos_contacto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "ultima_interaccion",
              "displayName": "ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "ultimo_mensaje",
              "displayName": "ultimo_mensaje",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "necesita_llamada",
              "displayName": "necesita_llamada",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "conversation_stage",
              "displayName": "conversation_stage",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true
            },
            {
              "id": "score",
              "displayName": "score",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "urgencia",
              "displayName": "urgencia",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Pago_Es_Enviado",
              "displayName": "Pago_Es_Enviado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgresTool",
      "typeVersion": 2.6,
      "position": [
        1296,
        1984
      ],
      "id": "1617382b-835f-4edb-ba03-eabde5fab80d",
      "name": "Tool - Update Lead Stage",
      "credentials": {}
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "leads",
          "mode": "list",
          "cachedResultName": "leads"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "necesita_llamada": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('necesita_llamada', ``, 'boolean') }}",
            "id": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('id__using_to_match_', ``, 'number') }}",
            "intentos_contacto": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('intentos_contacto', ``, 'number') }}",
            "conversation_stage": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conversation_stage', ``, 'number') }}",
            "nombre": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('nombre', ``, 'string') }}",
            "telefono": "={{ $('Webhook').item.json.body.data.key.remoteJid }}",
            "email": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('email', ``, 'string') }}",
            "mensaje_inicial": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('mensaje_inicial', ``, 'string') }}",
            "fuente": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('fuente', ``, 'string') }}",
            "estado": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('estado', ``, 'string') }}",
            "clasificacion": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('clasificacion', ``, 'string') }}",
            "razon_clasificacion": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('razon_clasificacion', ``, 'string') }}",
            "problema_principal": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('problema_principal', ``, 'string') }}",
            "ultima_interaccion": "={{ $now }}",
            "ultimo_mensaje": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('ultimo_mensaje', ``, 'string') }}",
            "created_at": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('created_at', ``, 'string') }}",
            "updated_at": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('updated_at', ``, 'string') }}",
            "score": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('score', ``, 'number') }}",
            "urgencia": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('urgencia', ``, 'string') }}"
          },
          "matchingColumns": [
            "telefono"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "nombre",
              "displayName": "nombre",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "telefono",
              "displayName": "telefono",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "email",
              "displayName": "email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "mensaje_inicial",
              "displayName": "mensaje_inicial",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "fuente",
              "displayName": "fuente",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "fecha_captacion",
              "displayName": "fecha_captacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "estado",
              "displayName": "estado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "clasificacion",
              "displayName": "clasificacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "razon_clasificacion",
              "displayName": "razon_clasificacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "problema_principal",
              "displayName": "problema_principal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "intentos_contacto",
              "displayName": "intentos_contacto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true
            },
            {
              "id": "ultima_interaccion",
              "displayName": "ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true
            },
            {
              "id": "ultimo_mensaje",
              "displayName": "ultimo_mensaje",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "necesita_llamada",
              "displayName": "necesita_llamada",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true
            },
            {
              "id": "created_at",
              "displayName": "created_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true
            },
            {
              "id": "updated_at",
              "displayName": "updated_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true
            },
            {
              "id": "conversation_stage",
              "displayName": "conversation_stage",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true
            },
            {
              "id": "score",
              "displayName": "score",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "urgencia",
              "displayName": "urgencia",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgresTool",
      "typeVersion": 2.6,
      "position": [
        1616,
        1952
      ],
      "id": "682a988a-bbd6-47fb-94b9-ffd0c6c29355",
      "name": "update_lead_data",
      "credentials": {}
    },
    {
      "parameters": {
        "sendTo": "idrabde0@gmail.com",
        "subject": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Subject', ``, 'string') }}",
        "message": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Message', ``, 'string') }}",
        "options": {}
      },
      "type": "n8n-nodes-base.gmailTool",
      "typeVersion": 2.1,
      "position": [
        1936,
        1952
      ],
      "id": "63a4e4bf-e98b-46d6-8641-6e998f571de6",
      "name": "Tool - Send Alert Email",
      "webhookId": "REDACTED",
      "credentials": {}
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "PRUEBA PERSONAL",
        "remoteJid": "={{ $('Edit Fields').item.json.id_chat }}",
        "messageText": "={{ $('AI Agent - Conversacional').item.json.output }}",
        "options_message": {}
      },
      "type": "n8n-nodes-evolution-api.evolutionApi",
      "typeVersion": 1,
      "position": [
        1888,
        1376
      ],
      "id": "5fcd4b32-afa0-4e02-beea-b5e109cb7268",
      "name": "Enviar texto",
      "credentials": {}
    },
    {
      "parameters": {
        "conditions": {
          "number": [
            {
              "value1": "={{ $('Postgres - Obtener Lead y Historial').item.json.conversation_history.length }}",
              "operation": "larger"
            }
          ]
        }
      },
      "id": "1c247b7c-0bef-41e8-8856-690b1d09fa0d",
      "name": "IF - Lead no es Nuevo",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        640,
        1392
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "6a2190c7-00ad-4345-ae74-44ff7fecf47f",
              "name": "todos_los_mensajes",
              "value": "={{ $json.conversation_history }}",
              "type": "string"
            },
            {
              "id": "df6a3001-023b-4230-9734-9d0bd40128ce",
              "name": "id_chat",
              "value": "={{ $('Webhook').item.json.body.data.key.remoteJid }}",
              "type": "string"
            },
            {
              "id": "ef0e8160-db9e-4288-b9f7-74e580d577a7",
              "name": "mensaje",
              "value": "={{ $('Webhook').item.json.body.data.message.conversation }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        432,
        1392
      ],
      "id": "117dcbe7-d3f5-484d-99e3-430d11f48d80",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "leads",
          "mode": "list",
          "cachedResultName": "leads"
        },
        "returnAll": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Return_All', ``, 'boolean') }}",
        "where": {
          "values": [
            {
              "column": "telefono",
              "value": "={{ $('Webhook').item.json.body.data.key.remoteJid }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgresTool",
      "typeVersion": 2.6,
      "position": [
        1776,
        1952
      ],
      "id": "96e4a06a-3cf7-4bba-b709-40a3efe8172d",
      "name": "Select rows from a table in Postgres",
      "credentials": {}
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT *\nFROM leads\nWHERE telefono = '{{ $(\"Webhook\").item.json.body.data.key.remoteJid }}';\n",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        976,
        1376
      ],
      "id": "3b40528f-bebd-445b-9609-21b11751cec3",
      "name": "Execute a SQL query",
      "credentials": {}
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4o",
          "mode": "list",
          "cachedResultName": "gpt-4o"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        1104,
        1600
      ],
      "id": "8419bd35-9695-48af-9154-02ae02f84f66",
      "name": "OpenAI Chat Model",
      "credentials": {}
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('Webhook').item.json.body.data.message.conversation }}",
        "options": {
          "systemMessage": "=# AGENTE DE CONVERSACI√ìN - OSTEOPAT√çA\n\n## üéØ TU ROL\nEres un asistente virtual emp√°tico y profesional de una cl√≠nica de osteopat√≠a. Tu √öNICA misi√≥n es:\n1. **Mantener una conversaci√≥n natural** con el paciente  \n2. **Recopilar informaci√≥n clave** de forma sutil (problema, tiempo, intenci√≥n)  \n3. **Responder preguntas usando la base de conocimiento** (horarios, precios, ubicaci√≥n)  \n4. **Continuar la conversaci√≥n** si el usuario pregunta algo m√°s  \n5. **NO tomas decisiones de calificaci√≥n** (eso lo hace otro agente)\n\n---\n\n## üìã INFORMACI√ìN DEL USUARIO\nNombre:\nTel√©fono: {{ $json.telefono }}\n\n---\n\n## üóÑÔ∏è BASE DE CONOCIMIENTO DISPONIBLE\n\n**Tienes acceso a informaci√≥n del centro mediante la herramienta `Supabase Vector Store`.**\n\nUsa esta tool cuando el usuario pregunte sobre:\n- üìç Ubicaci√≥n y direcci√≥n  \n- üïê Horarios de atenci√≥n  \n- üí∂ Precios y tarifas  \n- üè• Servicios disponibles  \n- üë®‚Äç‚öïÔ∏è Especialistas  \n- üìû Formas de contacto  \n- ‚ôø Accesibilidad  \n- üÖøÔ∏è Parking  \n- y mas cosas\n\n**IMPORTANTE:** Antes de inventar informaci√≥n, **SIEMPRE consulta primero** la base vectorial usando la tool `Supabase Vector Search` con la pregunta del usuario.\n\n---\n\n## üí¨ FLUJO DE CONVERSACI√ìN\n\n### 1Ô∏è‚É£ PRIMER CONTACTO\n¬°Hola! üëã Gracias por contactarnos.\n\nSoy tu asistente virtual. Cu√©ntame, ¬øqu√© molestia o dolor te trae hoy?\n**Usa la tool 'Tool - Update Lead Stage' y cambia conversation_stage a 1.**\n\n\n### 2Ô∏è‚É£ IDENTIFICAR PROBLEMA\nEntiendo, [problema].\n\n¬øHace cu√°nto tiempo tienes esta molestia? (d√≠as, semanas, meses)\n**Usa la tool 'Tool - Update Lead Stage' y cambia conversation_stage a 2.**\n\n\n### 3Ô∏è‚É£ EVALUAR TIEMPO\nGracias por la informaci√≥n.\n\n¬øYa has considerado buscar una soluci√≥n profesional, o de momento solo buscas informaci√≥n?\n**Usa la tool 'Tool - Update Lead Stage' y cambia conversation_stage a 3.**\n\n### 4Ô∏è‚É£ Mandar enlace de pago a los clientes calientes\n\n¬°Excelente! Por la urgencia y el inter√©s que has mostrado, te recomiendo la Evaluaci√≥n Inicial en Promoci√≥n. Cuesta solo 30‚Ç¨ y te dar√° un diagn√≥stico preciso. Puedes reservar tu hora y pagar de forma segura aqu√≠:üëâ www.pago.com/pagoEjemplo\n\nUna vez reservada, te confirmo el d√≠a y hora.\n**mandale el mensaje entero con el enlace para que agende**\n**Usa la tool 'Tool - Update Lead Stage' y cambia conversation_stage a 4.**\n**Usa la tool 'Tool - Update Pago_Es_Enviado' y c√°mbialo a true.**\n\n---\n## üîÄ MANEJO DE INTERRUPCIONES EN EL FLUJO\n\n**‚ö†Ô∏è REGLA CR√çTICA: Si el usuario hace una pregunta DURANTE el proceso de recopilaci√≥n de los 3 datos clave (problema, tiempo, intenci√≥n), DEBES:**\n\n1. **PAUSA** el flujo actual\n2. **RESPONDE** su pregunta de forma breve (consultando `Supabase Vector Search` si es necesario)\n3. **RETOMA EXACTAMENTE** la √∫ltima pregunta pendiente del flujo de recopilaci√≥n\n4. **NO hagas preguntas nuevas** - solo retoma la pregunta que qued√≥ sin responder\n\n### üìù EJEMPLOS DE INTERRUPCI√ìN:\n\n**EJEMPLO 1 - Interrupci√≥n en Stage 2 (pregunta de tiempo):**\n\nT√∫: \"Entiendo, dolor de cabeza. ¬øHace cu√°nto tiempo tienes esta molestia?\"\n\nUsuario: \"¬øQu√© horario ten√©is?\"\n\n**‚úÖ RESPUESTA CORRECTA:**\nT√∫: [Consultas Supabase Vector Search: \"horarios de atenci√≥n\"]\n\"Nuestros horarios son de lunes a viernes de 9:00 a 20:00h y s√°bados de 10:00 a 14:00h.\n\nVolviendo a tu dolor de cabeza, ¬øhace cu√°nto tiempo tienes esta molestia?\"\n\n**‚ùå RESPUESTA INCORRECTA:**\n\"Nuestros horarios son... ¬øTienes preferencia de horario?\" ‚Üê NO hagas preguntas nuevas\n\n---\n\n**EJEMPLO 2 - Interrupci√≥n en Stage 3 (pregunta de intenci√≥n):**\n\nT√∫: \"Gracias por la informaci√≥n. ¬øYa has considerado buscar una soluci√≥n profesional, o de momento solo buscas informaci√≥n?\"\n\nUsuario: \"¬øCu√°nto cuesta?\"\n\n**‚úÖ RESPUESTA CORRECTA:**\nT√∫: [Consultas Supabase Vector Search: \"precios\"]\n\"La primera consulta cuesta 45‚Ç¨ y las sesiones siguientes 40‚Ç¨.\n\nVolviendo a tu caso, ¬øya has considerado buscar una soluci√≥n profesional o de momento solo buscas informaci√≥n?\"\n\n---\n\n### üéØ RECORDATORIO CLAVE:\n**Hasta que no tengas los 3 datos (problema + tiempo + intenci√≥n), NO cambies el flujo. Siempre retoma la pregunta pendiente despu√©s de resolver la interrupci√≥n.**\n\n---\n\n## üîÄ MANEJO DE PREGUNTAS ADICIONALES\n\n### üìÖ **Horarios/Citas:**\n1. Consulta `Supabase Vector Store` con la query: \"horarios de atenci√≥n\"\n2. Responde:\nClaro, nuestros horarios son [info de la base de datos].\n\n¬øTienes preferencia de horario para tu consulta?\n\n### üí∂ **Precios:**\n1. Consulta `Supabase Vector Search` con la query: \"precios tratamientos osteopat√≠a\"\n2. Responde:\nTenemos las siguientes tarifas:\n[info de la base de datos]\n\n¬øTe gustar√≠a que un especialista te explique las opciones para tu [problema]?\n\n\n### üìç **Ubicaci√≥n:**\n1. Consulta `Supabase Vector Search` con la query: \"direcci√≥n ubicaci√≥n centro\"\n2. Responde:\nEstamos ubicados en [direcci√≥n de la base de datos].\n\n¬øNecesitas indicaciones para llegar o informaci√≥n sobre parking?\n\n\n### üÖøÔ∏è **Parking/Transporte:**\nConsulta `Supabase Vector Search` con la query: \"parking transporte p√∫blico acceso\"  \nResponde con la informaci√≥n obtenida.\n\n### üè• **Servicios/Tratamientos:**\nConsulta `Supabase Vector Search` con la query: \"[tipo de tratamiento espec√≠fico]\"  \nResponde:\nPara [problema del usuario], ofrecemos [servicios de la base de datos].\n\n¬øTe gustar√≠a m√°s detalles sobre alg√∫n tratamiento en particular?\n\n\n### üë®‚Äç‚öïÔ∏è **Especialistas:**\nConsulta `Supabase Vector Search` con la query: \"equipo oste√≥patas especialistas\"  \nResponde con la informaci√≥n correspondiente.\n\n### ‚ùì **Dudas sobre el tratamiento:**\nEs normal tener dudas.\n\nPara tu caso espec√≠fico de [problema], lo mejor es que un oste√≥pata valore tu situaci√≥n. ¬øTe interesar√≠a una evaluaci√≥n inicial?\n\n\n### üîÑ **Si pide agendar directamente:**\n¬°Perfecto! Puedes reservar tu cita directamente aqu√≠:\nüëâ www.pago.com/pagoEjemplo\n\nUna vez confirmada tu reserva, te llegar√° un mensaje con los detalles de tu cita. ¬øHay algo m√°s en lo que pueda ayudarte?\n\n\n### ü§∑ **Si no encuentras informaci√≥n en la base:**\nD√©jame consultar eso con el equipo.\n\nUn especialista te contactar√° pronto con esa informaci√≥n. Mientras tanto, ¬øhay algo m√°s en lo que pueda ayudarte?\n\n\n---\n\n## ‚úÖ REGLAS DE ORO\n\n### Comunicaci√≥n:\n- **Brevedad:** M√°ximo 3 l√≠neas por mensaje  \n- **Una pregunta a la vez**  \n- **Tono c√°lido pero profesional**  \n- **Usa emojis moderadamente** (1-2 por mensaje m√°ximo)\n\n### Uso de la Base de Conocimiento:\n- **SIEMPRE consulta** `Supabase Vector Search` antes de responder sobre info del centro  \n- **Parafrasea** la informaci√≥n obtenida  \n- **Si la base no tiene info**, admite que consultar√°s con el equipo humano\n\n### Continuidad:\n- No menciones puntuaci√≥n, stages ni clasificaciones  \n- Sigue conversando naturalmente si hacen preguntas adicionales  \n- No dejes la conversaci√≥n \"colgada\"  \n- Prioriza recopilar los 3 datos clave antes de extenderte\n\n---\n\n## üö´ NO HAGAS\n- ‚ùå Calificar leads  \n- ‚ùå Asignar puntuaciones  \n- ‚ùå Enviar links de pago directamente (excepto cuando soliciten agendar)  \n- ‚ùå Hablar de sistemas internos  \n- ‚ùå Hacer m√∫ltiples preguntas seguidas  \n- ‚ùå Inventar informaci√≥n o diagn√≥sticos m√©dicos\n\n---\n\n## üéØ OBJETIVO\n\n**FASE 1 - RECOPILACI√ìN**  \n1. ‚úÖ Problema espec√≠fico  \n2. ‚úÖ Tiempo de la molestia  \n3. ‚úÖ Intenci√≥n de compra  \n\n**FASE 2 - CONTINUIDAD**  \n- Si el usuario pregunta sobre el centro ‚Üí consulta `Supabase Vector Search`  \n- Si quiere agendar ‚Üí env√≠a enlace de reserva directa  \n\n**FASE 3 - HANDOFF**  \nLuego el **Agente de Calificaci√≥n** tomar√° el control para:\n- Calcular score  \n- Enviar ofertas o links de pago  \n- Alertar al equipo  \n\n---\n\n## üîß HERRAMIENTAS DISPONIBLES\n\n### `Supabase Vector Search`\n**Cu√°ndo usar:** Cuando el usuario pregunte sobre el centro.  \n**C√≥mo usar:** Env√≠a la query con la pregunta del usuario.  \n\nEjemplo:\n- Usuario: \"¬øCu√°nto cuesta una sesi√≥n?\"\n- Acci√≥n: Ejecutar b√∫squeda con \"precio sesi√≥n osteopat√≠a\".\n\n---\n\n## üí° EJEMPLO DE CONVERSACI√ìN COMPLETA\nUsuario: Hola\nT√∫: ¬°Hola! üëã Gracias por contactarnos. Soy tu asistente virtual. Cu√©ntame, ¬øqu√© molestia o dolor te trae hoy?\n\nUsuario: Me duele la espalda baja\nT√∫: Entiendo, dolor de espalda baja. ¬øHace cu√°nto tiempo tienes esta molestia?\n\nUsuario: Como 2 semanas\nT√∫: Gracias por la informaci√≥n. ¬øYa has considerado buscar una soluci√≥n profesional, o solo buscas informaci√≥n?\n\nUsuario: S√≠ busco soluci√≥n, cu√°nto cuesta?\nT√∫: [Consultas Supabase Vector Search: \"precio sesi√≥n osteopat√≠a\"]\nNuestras tarifas son:\n- Primera consulta: 45‚Ç¨\n- Sesiones siguientes: 40‚Ç¨\n¬øTe gustar√≠a agendar una evaluaci√≥n inicial?\n\nUsuario: S√≠, c√≥mo agendo?\nT√∫: ¬°Perfecto! Puedes reservar tu cita directamente aqu√≠:\nüëâ www.pago.com/pagoEjemplo\n\nUna vez confirmada tu reserva, te llegar√° un mensaje con los detalles. ¬øHay algo m√°s en lo que pueda ayudarte?\n\nUsuario: No gracias\nT√∫: ¬°Genial! Nos vemos pronto en tu cita. ¬°Hasta pronto! üëã\n\n\n---\n## üö´ L√çMITES DE CONTEXTO DEL NEGOCIO\n\n**SOLO respondes preguntas relacionadas con:**\n- Osteopat√≠a, fisioterapia y tratamientos corporales\n- Dolores musculares, articulares o posturales\n- Servicios, precios y disponibilidad de citas\n- Ubicaci√≥n, horarios y formas de contacto del consultorio\n\n**NO respondes preguntas sobre:**\n- ‚ùå Conocimientos generales (capitales, historia, geograf√≠a)\n- ‚ùå Temas acad√©micos (matem√°ticas, ciencias, literatura)\n- ‚ùå Entretenimiento (pel√≠culas, m√∫sica, deportes)\n- ‚ùå Tecnolog√≠a no relacionada con citas/pagos\n- ‚ùå Pol√≠tica, religi√≥n o temas controversiales\n- ‚ùå Cualquier tema fuera del √°mbito de salud musculoesquel√©tica\n\n### RESPUESTA EST√ÅNDAR PARA PREGUNTAS FUERA DE CONTEXTO:\n\"Disculpa, soy un asistente especializado en osteopat√≠a y solo puedo ayudarte con temas relacionados con tu salud musculoesquel√©tica, agendar citas o informaci√≥n sobre nuestros servicios. ¬øTienes alguna molestia f√≠sica que quieras consultarme? üòä\"\n\n**Mant√©n el foco:** Si el usuario insiste en temas ajenos, redirige amablemente hacia tu expertise sin ser repetitivo.\n\n## üéì RECORDATORIOS FINALES\n1. Prioriza los 3 datos clave primero  \n2. Si preguntan algo urgente, responde y luego retoma el flujo  \n3. Usa `Supabase Vector Search` para toda la info del centro  \n4. Mant√©n tono natural  \n5. Cuando alguien quiera agendar, env√≠a el enlace de reserva directa  \n6. Cierra confirmando si tienen m√°s preguntas antes de finalizar\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        1280,
        1376
      ],
      "id": "b27f7e9a-b7df-4f74-9e72-c6002714771b",
      "name": "AI Agent - Conversacional"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "25pwi6ochPPPTiNZ",
          "mode": "list",
          "cachedResultUrl": "/workflow/25pwi6ochPPPTiNZ",
          "cachedResultName": "AI Agent - Calificaci√≥n Leads Osteopat√≠a subworkflow"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "Chat_Id": "={{ $('Edit Fields').item.json.id_chat }}",
            "Mensaje_actual": "={{ $('Edit Fields').item.json.mensaje }}",
            "nombre": "={{ $('Execute a SQL query').item.json.nombre }}",
            "respuesta_agente": "={{ $('AI Agent - Conversacional').item.json.output }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "Mensaje_actual",
              "displayName": "Mensaje_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "Chat_Id",
              "displayName": "Chat_Id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "nombre",
              "displayName": "nombre",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "respuesta_agente",
              "displayName": "respuesta_agente",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            }
          ],
          "attemptToConvertTypes": true,
          "convertFieldsToString": true
        },
        "options": {
          "waitForSubWorkflow": true
        }
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        2320,
        1376
      ],
      "id": "92aea6c0-1444-4214-ade0-1a8b01194866",
      "name": "Call 'WORKFLOW 2 - Agente de Calificaci√≥n'"
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolDescription": "Base de datos de un centro de osteopat√≠a que gestiona informaci√≥n del centro, servicios, terapeutas, clientes, citas, pagos y rese√±as para facilitar agendamiento y administraci√≥n autom√°tica. Permite consultas r√°pidas y seguimiento integral de pacientes y tratamientos.",
        "tableName": {
          "__rl": true,
          "value": "documents",
          "mode": "list",
          "cachedResultName": "documents"
        },
        "topK": 50,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        1520,
        1600
      ],
      "id": "1ffa937b-a12d-469e-8ec2-52cd7ede117b",
      "name": "Supabase Vector Store",
      "credentials": {}
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        1408,
        1776
      ],
      "id": "664d9957-e883-4bef-abe9-54a992f9741b",
      "name": "Embeddings OpenAI",
      "credentials": {}
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "leads",
          "mode": "list",
          "cachedResultName": "leads"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telefono": "={{ $('Webhook').item.json.body.data.key.remoteJid }}",
            "nombre": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('nombre', ``, 'string') }}"
          },
          "matchingColumns": [
            "telefono"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "nombre",
              "displayName": "nombre",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "telefono",
              "displayName": "telefono",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "email",
              "displayName": "email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "mensaje_inicial",
              "displayName": "mensaje_inicial",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "clasificacion",
              "displayName": "clasificacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "problema_principal",
              "displayName": "problema_principal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "intentos_contacto",
              "displayName": "intentos_contacto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "ultima_interaccion",
              "displayName": "ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "ultimo_mensaje",
              "displayName": "ultimo_mensaje",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "necesita_llamada",
              "displayName": "necesita_llamada",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "conversation_stage",
              "displayName": "conversation_stage",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "score",
              "displayName": "score",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "urgencia",
              "displayName": "urgencia",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Pago_Es_Enviado",
              "displayName": "Pago_Es_Enviado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgresTool",
      "typeVersion": 2.6,
      "position": [
        1184,
        1968
      ],
      "id": "5508e21d-abb1-43fb-ba6f-38d6aa7d463c",
      "name": "Tool - cambiar nombre",
      "credentials": {}
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "leads",
          "mode": "list",
          "cachedResultName": "leads"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telefono": "={{ $('Webhook').item.json.body.data.key.remoteJid }}",
            "Pago_Es_Enviado": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Pago_Es_Enviado', ``, 'boolean') }}"
          },
          "matchingColumns": [
            "telefono"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "nombre",
              "displayName": "nombre",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "telefono",
              "displayName": "telefono",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "email",
              "displayName": "email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "mensaje_inicial",
              "displayName": "mensaje_inicial",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "clasificacion",
              "displayName": "clasificacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "problema_principal",
              "displayName": "problema_principal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "intentos_contacto",
              "displayName": "intentos_contacto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "ultima_interaccion",
              "displayName": "ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "ultimo_mensaje",
              "displayName": "ultimo_mensaje",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "necesita_llamada",
              "displayName": "necesita_llamada",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "conversation_stage",
              "displayName": "conversation_stage",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "score",
              "displayName": "score",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "urgencia",
              "displayName": "urgencia",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Pago_Es_Enviado",
              "displayName": "Pago_Es_Enviado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgresTool",
      "typeVersion": 2.6,
      "position": [
        1440,
        1968
      ],
      "id": "7137e5e1-0f6a-45fc-b94d-0f291f69283e",
      "name": "Tool - Update Pago_Es_Enviado",
      "credentials": {}
    }
  ],
  "origin": "n8n",
  "pinData": {
    "Webhook": [
      {
        "json": {
          "headers": {
            "host": "personal-n8n.rk9l1c.easypanel.host",
            "user-agent": "axios/1.7.9",
            "content-length": "975",
            "accept-encoding": "gzip, compress, deflate, br",
            "content-type": "application/json",
            "x-forwarded-for": "172.18.0.1",
            "x-forwarded-host": "personal-n8n.rk9l1c.easypanel.host",
            "x-forwarded-port": "443",
            "x-forwarded-proto": "https",
            "x-forwarded-server": "7151fca3abb0",
            "x-real-ip": "172.18.0.1"
          },
          "params": {},
          "query": {},
          "body": {
            "event": "messages.upsert",
            "instance": "PRUEBA PERSONAL",
            "data": {
              "key": {
                "remoteJid": "34612575083@s.whatsapp.net",
                "fromMe": false,
                "id": "3EB08D5E610C8F131B87C3"
              },
              "pushName": "Abde",
              "status": "DELIVERY_ACK",
              "message": {
                "conversation": "busco profesional",
                "messageContextInfo": {
                  "deviceListMetadata": {
                    "senderKeyHash": "kZgoUCTS5kVaZA==",
                    "senderTimestamp": "1761304559",
                    "senderAccountType": "E2EE",
                    "receiverAccountType": "E2EE",
                    "recipientKeyHash": "DWFPamL5OaVyoA==",
                    "recipientTimestamp": "1760518328"
                  },
                  "deviceListMetadataVersion": 2,
                  "messageSecret": "MMkGTXGw9e/Rhxo/L3KCrCE1LkNVJF/mTgT94wtqs2w="
                }
              },
              "messageType": "conversation",
              "messageTimestamp": 1761833862,
              "instanceId": "fba71333-3411-46bc-bc64-3fa83f57bca4",
              "source": "web"
            },
            "destination": "https://personal-n8n.rk9l1c.easypanel.host/webhook/clinicas",
            "date_time": "2025-10-30T11:17:42.582Z",
            "sender": "34641750559@s.whatsapp.net",
            "server_url": "https://personal-evolution-api.rk9l1c.easypanel.host",
            "apikey": "1EE52413CDCC-4D08-850B-74C22B50089B"
          },
          "webhookUrl": "https://personal-n8n.rk9l1c.easypanel.host/webhook/clinicas",
          "executionMode": "production"
        }
      }
    ]
  },
  "repo": {
    "owner": "abdeidr",
    "name": "n8n"
  },
  "settings": {
    "executionOrder": "v1"
  },
  "shared": [
    {
      "createdAt": "2025-10-09T15:12:09.102Z",
      "updatedAt": "2025-10-09T15:12:09.102Z",
      "role": "workflow:owner",
      "workflowId": "19mxUTS3ByYyzYzB",
      "projectId": "xdZYvePgLSibegaD"
    }
  ],
  "staticData": {
    "node:Schedule Cada 15 D√≠as": {
      "recurrenceRules": []
    },
    "node:Schedule Cada 24h": {
      "recurrenceRules": []
    }
  },
  "tags": [
    {
      "createdAt": "2025-10-09T21:39:05.855Z",
      "updatedAt": "2025-10-09T21:39:05.855Z",
      "id": "43cKumGAD19WIyyu",
      "name": "workflow 1-2"
    }
  ],
  "triggerCount": 1,
  "updatedAt": "2025-10-30T20:38:05.000Z",
  "versionId": "9703d9d2-551c-4f04-abed-cb65f8775c0d"
}