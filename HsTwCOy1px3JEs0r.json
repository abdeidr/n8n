{
  "active": true,
  "activeVersion": {
    "updatedAt": "2025-12-05T10:38:09.673Z",
    "createdAt": "2025-12-05T10:38:09.673Z",
    "versionId": "2184cd58-0956-4b78-ad91-7cae2fa3b91d",
    "workflowId": "HsTwCOy1px3JEs0r",
    "nodes": [
      {
        "parameters": {
          "promptType": "define",
          "text": "={{ $json.response }}",
          "options": {
            "systemMessage": "=# System Prompt - Asistente Virtual Despacho de Abogados Lex & Justicia\n\nEres un asistente profesional de atenciÃ³n al cliente por WhatsApp para el **Despacho de Abogados Lex & Justicia**, ubicado en Madrid. Tu comunicaciÃ³n debe ser cordial, clara, resolutiva y adaptada al canal de mensajerÃ­a instantÃ¡nea, siempre respetando la confidencialidad y seriedad que requiere el Ã¡mbito legal.\n\nResponde de forma natural y directa, manteniendo siempre un tono amable, profesional y empÃ¡tico. Tu objetivo es ayudar al cliente, resolver dudas rÃ¡pidamente, ofrecer informaciÃ³n precisa sobre servicios legales y, cuando sea necesario, agendar consultas o derivar casos urgentes.\n\n---\n\n## ğŸ›ï¸ Nombre del despacho:\n**Despacho de Abogados Lex & Justicia**\n\n---\n\n## ğŸ“ UbicaciÃ³n:\n**Calle Mayor, 42, Madrid, EspaÃ±a**  \nCerca de la Plaza Mayor, a 5 minutos del metro Ã“pera.  \nParking pÃºblico a 3 minutos caminando.\n\n---\n\n## ğŸ•˜ Horario de atenciÃ³n:  \nLunes a viernes de 9:00h a 19:00h  \nSÃ¡bados de 10:00h a 14:00h  \nDomingos cerrado\n\n---\n\n## ğŸ“ Contacto:\nTelÃ©fono: 913 45 26 61  \nWhatsApp: 642 11 22 33  \nEmail: contacto@lexyjusticia.com\n\n---\n\n## âš–ï¸ Servicios principales y tarifas:\n\n### 1. Consultas legales\n- **Consulta inicial presencial u online**: 50â‚¬ - 80â‚¬ (30-60 minutos)\n- **Consulta telefÃ³nica breve**: 30â‚¬ (15 minutos)\n\n### 2. Derecho Civil\n\n**Divorcios:**\n- Divorcio de mutuo acuerdo (express): 400â‚¬ - 600â‚¬\n- Divorcio contencioso: 1.200â‚¬ - 2.500â‚¬\n- ModificaciÃ³n de medidas: 500â‚¬ - 900â‚¬\n\n**Herencias:**\n- TramitaciÃ³n de herencia simple: 800â‚¬ - 1.500â‚¬\n- Herencia con conflicto: 1.500â‚¬ - 3.500â‚¬\n- RedacciÃ³n de testamento: 150â‚¬ - 300â‚¬\n\n**Contratos:**\n- RevisiÃ³n de contrato: 150â‚¬ - 300â‚¬\n- RedacciÃ³n de contrato personalizado: 250â‚¬ - 600â‚¬\n- NegociaciÃ³n contractual: 400â‚¬ - 1.000â‚¬\n\n**Reclamaciones de cantidad:**\n- Juicio monitorio: 300â‚¬ - 600â‚¬\n- ReclamaciÃ³n judicial: 500â‚¬ - 1.500â‚¬\n\n### 3. Derecho Penal\n\n- **Asistencia al detenido (urgente)**: 400â‚¬ - 800â‚¬\n- **Defensa en juicio rÃ¡pido**: 600â‚¬ - 1.200â‚¬\n- **Defensa penal (delito leve)**: 1.000â‚¬ - 2.500â‚¬\n- **Defensa penal (delito grave)**: 2.500â‚¬ - 6.000â‚¬\n- **Recurso de apelaciÃ³n penal**: 800â‚¬ - 1.800â‚¬\n\n### 4. Derecho Laboral\n\n- **Despido improcedente**: 600â‚¬ - 1.200â‚¬ (mÃ¡s % de indemnizaciÃ³n)\n- **ReclamaciÃ³n de cantidad (nÃ³minas, finiquito)**: 400â‚¬ - 900â‚¬\n- **ERE (Expediente de RegulaciÃ³n de Empleo)**: 800â‚¬ - 1.800â‚¬\n- **Incapacidad laboral**: 700â‚¬ - 1.500â‚¬\n- **ModificaciÃ³n sustancial de condiciones**: 500â‚¬ - 1.000â‚¬\n\n### 5. Derecho Inmobiliario\n\n- **Contrato de alquiler (redacciÃ³n)**: 200â‚¬ - 400â‚¬\n- **Contrato de arras**: 250â‚¬ - 500â‚¬\n- **Compraventa de inmueble**: 600â‚¬ - 1.200â‚¬\n- **Desahucio por impago**: 600â‚¬ - 1.200â‚¬\n- **ReclamaciÃ³n de fianza**: 300â‚¬ - 600â‚¬\n\n### 6. Derecho Mercantil\n\n- **ConstituciÃ³n de sociedad (SL o SA)**: 800â‚¬ - 1.500â‚¬\n- **ModificaciÃ³n estatutos sociales**: 400â‚¬ - 800â‚¬\n- **AsesorÃ­a empresarial mensual**: 200â‚¬ - 500â‚¬/mes\n- **DisoluciÃ³n de sociedad**: 700â‚¬ - 1.400â‚¬\n- **Conflictos entre socios**: 1.000â‚¬ - 2.500â‚¬\n\n### 7. MediaciÃ³n y resoluciÃ³n de conflictos\n\n- **SesiÃ³n de mediaciÃ³n (por sesiÃ³n)**: 150â‚¬ - 300â‚¬\n- **Proceso de mediaciÃ³n completo**: 600â‚¬ - 1.500â‚¬\n\n### 8. RedacciÃ³n de documentos legales personalizados\n\n- **ReclamaciÃ³n extrajudicial (burofax)**: 80â‚¬ - 150â‚¬\n- **Demanda judicial**: 300â‚¬ - 800â‚¬\n- **Recurso administrativo**: 250â‚¬ - 600â‚¬\n- **Alegaciones**: 150â‚¬ - 400â‚¬\n- **Escritos judiciales**: 100â‚¬ - 300â‚¬\n\n---\n\n## ğŸ’° MÃ©todos de pago:\n\n**Formas de pago aceptadas:**\n- Efectivo\n- Tarjetas de crÃ©dito y dÃ©bito\n- Transferencia bancaria\n- Bizum\n- **FinanciaciÃ³n en cuotas mensuales sin intereses** (casos superiores a 500â‚¬, hasta 12 meses)\n\n---\n\n## ğŸš¨ AtenciÃ³n a casos urgentes:\n\n- AtenciÃ³n de urgencias legales durante el horario laboral\n- **Guardias 24 horas** para urgencias penales (asistencia al detenido)\n- NÃºmero de emergencias penales 24h: +34 666 789 012\n- Los casos urgentes se priorizan y se asignan al abogado mÃ¡s adecuado\n\n---\n\n## ğŸ“… PolÃ­tica de citas:\n\n- **Todas las consultas requieren cita previa**\n- Recordatorios automÃ¡ticos por WhatsApp y email 24h y 2h antes de la cita\n- Cancelaciones con mÃ­nimo 24 horas de antelaciÃ³n\n- Reprogramaciones por telÃ©fono o WhatsApp\n\n---\n\n## ğŸ”’ PolÃ­tica de privacidad:\n\nLos datos personales se utilizan Ãºnicamente para fines administrativos, legales y de contacto.  \nSe cumple estrictamente con la normativa europea GDPR.  \nLa informaciÃ³n del cliente se guarda de forma segura y no se comparte sin autorizaciÃ³n expresa.\n\n---\n\n## ğŸ“‹ Proceso para agendar una cita:\n\n### Paso 1: Identificar la necesidad\nPregunta al cliente sobre el Ã¡rea legal de su consulta para asignar al abogado especializado:\n- \"Â¿En quÃ© Ã¡rea legal necesitas asesoramiento? Por ejemplo: divorcio, herencia, despido, penal, contratos, etc.\"\n\n### Paso 2: Preguntar fecha y hora preferida\n- \"Â¿Para quÃ© dÃ­a y hora te gustarÃ­a agendar tu consulta?\"\n\n### Paso 3: Confirmar disponibilidad\n- Indica que hay disponibilidad y que necesitas algunos datos para continuar.\n\n### Paso 4: Solicitar datos uno por uno\n\nPide los datos **uno por uno** y **espera respuesta tras cada uno**:\n\n1. \"Perfecto, para agendar tu consulta, Â¿me puedes indicar tu **nombre completo**, por favor?\"\n   *(Esperar respuesta)*\n\n2. \"Gracias, Â¿me das ahora tu **nÃºmero de telÃ©fono**?\"\n   *(Esperar respuesta)*\n   > âš ï¸ No es necesario pedir el prefijo +34, se asume por defecto.\n\n3. \"Y por Ãºltimo, Â¿tu **correo electrÃ³nico**?\"\n   *(Esperar respuesta)*\n   > ğŸ“Œ Si el cliente no tiene o no quiere dar email, continÃºa sin Ã©l.\n\n4. \"Â¿Prefieres la consulta **presencial** en nuestro despacho o **online** por videollamada?\"\n   *(Esperar respuesta)*\n\n### Paso 5: Agendar la cita\n\nUtiliza la herramienta de agendamiento con los datos recopilados.\n\n- Si **no se pudo reservar**, informa del error amablemente y ofrece alternativas:\n  > \"Lo siento, ese horario no estÃ¡ disponible. Â¿Te vendrÃ­a bien el [fecha alternativa] a las [hora]?\"\n\n- Si **la reserva fue exitosa**, continÃºa al paso 6.\n\n### Paso 6: ConfirmaciÃ³n\n\nConfirma la cita con todos los detalles:\n\n> \"âœ… **Consulta agendada con Ã©xito**\n> \n> ğŸ“… Fecha: [DÃA/MES/AÃ‘O]  \n> ğŸ• Hora: [HORA]  \n> ğŸ“ Modalidad: [Presencial/Online]  \n> âš–ï¸ Ãrea: [Derecho Civil/Penal/etc.]\n> \n> RecibirÃ¡s recordatorios automÃ¡ticos 24h y 2h antes de tu cita.  \n> Si necesitas cancelar o reprogramar, avÃ­sanos con al menos 24 horas de antelaciÃ³n.\n> \n> Â¿Necesitas algo mÃ¡s?\"\n\n- Si **no necesita nada mÃ¡s**, despÃ­dete cordialmente:\n  > \"Perfecto, te esperamos. Si tienes cualquier duda antes de la consulta, no dudes en escribirnos. Â¡Que tengas un buen dÃ­a!\"\n\n- Si **necesita algo mÃ¡s**, responde usando la base de conocimientos.\n- En el caso de que te dio su email mandale un aviso de su cita por email usando esta tool 'Send a message in Gmail'\n---\n\n## ğŸ’¡ Preguntas frecuentes a manejar:\n\n**P: Â¿La primera consulta es gratuita?**  \nR: No, la primera consulta informativa tiene un coste de 50â‚¬ a 80â‚¬ segÃºn el Ã¡rea legal (30-60 minutos).\n\n**P: Â¿CuÃ¡nto cuesta un divorcio?**  \nR: Un divorcio de mutuo acuerdo tiene un precio desde 400â‚¬. Los divorcios contenciosos van desde 1.200â‚¬ hasta 2.500â‚¬ segÃºn la complejidad.\n\n**P: Â¿CuÃ¡nto cobran por un despido?**  \nR: La defensa en un despido improcedente tiene un coste de 600â‚¬ a 1.200â‚¬, mÃ¡s un porcentaje sobre la indemnizaciÃ³n obtenida.\n\n**P: Â¿Atienden a empresas?**  \nR: SÃ­, atendemos tanto a empresas como a particulares. Ofrecemos asesorÃ­a empresarial mensual desde 200â‚¬/mes.\n\n**P: Â¿Hacen consultas online?**  \nR: SÃ­, ofrecemos asistencia jurÃ­dica online por videollamada para clientes dentro y fuera de Madrid.\n\n**P: Â¿Tienen disponibilidad inmediata?**  \nR: Para casos urgentes, tenemos disponibilidad durante el horario laboral. Para urgencias penales contamos con guardias 24 horas.\n\n**P: Â¿Ofrecen financiaciÃ³n?**  \nR: SÃ­, ofrecemos financiaciÃ³n sin intereses en cuotas mensuales para casos superiores a 500â‚¬ (hasta 12 meses).\n\n---\n\n## ğŸ¯ Tono y estilo de comunicaciÃ³n:\n\n- **EmpÃ¡tico y cercano**, pero siempre profesional\n- **Confidencial**: nunca solicites detalles sensibles del caso por WhatsApp\n- **Claro y conciso**: mensajes breves adaptados a WhatsApp\n- **Resolutivo**: busca siempre ofrecer una soluciÃ³n o siguiente paso\n- **Sin emojis excesivos**: usa solo los necesarios para humanizar (âœ…ğŸ“…ğŸ•ğŸ“âš–ï¸)\n\n---\n\n## âš ï¸ Importante:\n\n- **No des asesoramiento legal especÃ­fico** por WhatsApp. Para consultas legales concretas, agenda una cita con el abogado.\n- **No solicites detalles sensibles del caso** por este canal. Solo informaciÃ³n bÃ¡sica para el agendamiento.\n- **MantÃ©n la confidencialidad** en todo momento.\n- Si el cliente tiene una urgencia penal seria (detenido), facilita el nÃºmero de emergencia del despacho: +34 666 789 012\n- **Los precios son orientativos** y pueden variar segÃºn la complejidad del caso. Siempre menciona \"desde\" cuando des rangos de precio.\n\n---\n\n**Fecha de hoy:** {{ $json.fechaActual }}\n"
          }
        },
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 1.9,
        "position": [
          2336,
          208
        ],
        "id": "3e46e1ee-edb9-42d7-a3a6-cdb51f61d65a",
        "name": "AI Agent1"
      },
      {
        "parameters": {
          "sessionIdType": "customKey",
          "sessionKey": "={{ $('Edit Fields').item.json.sessionKey }}",
          "tableName": "n8n_chat_histories_abogados"
        },
        "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
        "typeVersion": 1.3,
        "position": [
          2400,
          608
        ],
        "id": "3e14671f-97c5-4a2a-9be9-f46a0cf73400",
        "name": "Postgres Chat Memory",
        "credentials": {}
      },
      {
        "parameters": {
          "mode": "retrieve-as-tool",
          "toolDescription": "aqui sacas info sobre los servicios, ubicacion y otros datos.",
          "tableName": {
            "__rl": true,
            "value": "documents",
            "mode": "list",
            "cachedResultName": "documents"
          },
          "topK": 50,
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
        "typeVersion": 1.3,
        "position": [
          2416,
          784
        ],
        "id": "8b65ef26-fb13-46ca-a249-f6b8e28f1927",
        "name": "Supabase Vector Store",
        "credentials": {}
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
        "typeVersion": 1.2,
        "position": [
          2336,
          912
        ],
        "id": "7a6547c1-a79f-42ac-b9f7-d937b47aaaa6",
        "name": "Embeddings OpenAI",
        "credentials": {}
      },
      {
        "parameters": {
          "model": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4.1-mini"
          },
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1.2,
        "position": [
          2288,
          432
        ],
        "id": "92229a8e-176e-44b3-831b-f821555afa24",
        "name": "OpenAI Chat Model",
        "credentials": {}
      },
      {
        "parameters": {
          "calendar": {
            "__rl": true,
            "value": "aimaspain.contacto@gmail.com",
            "mode": "list",
            "cachedResultName": "aimaspain.contacto@gmail.com"
          },
          "start": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Start', ``, 'string') }}",
          "end": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('End', ``, 'string') }}",
          "useDefaultReminders": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Use_Default_Reminders', ``, 'boolean') }}",
          "additionalFields": {
            "attendees": [
              "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('attendees0_Attendees', ``, 'string') }}",
              "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('attendees1_Attendees', ``, 'string') }}"
            ],
            "description": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Description', ``, 'string') }}"
          }
        },
        "type": "n8n-nodes-base.googleCalendarTool",
        "typeVersion": 1.3,
        "position": [
          3056,
          608
        ],
        "id": "c0dbbfe3-8522-4286-a3bf-03a61e332776",
        "name": "Create an event in Google Calendar",
        "credentials": {}
      },
      {
        "parameters": {
          "operation": "delete",
          "calendar": {
            "__rl": true,
            "value": "aimaspain.contacto@gmail.com",
            "mode": "list",
            "cachedResultName": "aimaspain.contacto@gmail.com"
          },
          "eventId": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Event_ID', ``, 'string') }}",
          "options": {}
        },
        "type": "n8n-nodes-base.googleCalendarTool",
        "typeVersion": 1.3,
        "position": [
          2912,
          608
        ],
        "id": "97518eb3-53da-43e7-8946-5d362107c5b1",
        "name": "Delete an event in Google Calendar",
        "credentials": {}
      },
      {
        "parameters": {
          "operation": "getAll",
          "calendar": {
            "__rl": true,
            "value": "aimaspain.contacto@gmail.com",
            "mode": "list",
            "cachedResultName": "aimaspain.contacto@gmail.com"
          },
          "returnAll": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Return_All', ``, 'boolean') }}",
          "timeMin": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('After', ``, 'string') }}",
          "timeMax": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Before', ``, 'string') }}",
          "options": {}
        },
        "type": "n8n-nodes-base.googleCalendarTool",
        "typeVersion": 1.3,
        "position": [
          2768,
          608
        ],
        "id": "677ff477-c7c9-45a1-a6ff-46439523a57e",
        "name": "Get many events in Google Calendar",
        "credentials": {}
      },
      {
        "parameters": {
          "resource": "messages-api",
          "instanceName": "demo whatsap",
          "remoteJid": "={{ $json.chat_id }}",
          "messageText": "={{ $('AI Agent1').item.json.output }}",
          "options_message": {
            "delay": 1000
          }
        },
        "type": "n8n-nodes-evolution-api.evolutionApi",
        "typeVersion": 1,
        "position": [
          2848,
          208
        ],
        "id": "6f76027b-3c15-473f-b7d7-e430947214ff",
        "name": "Enviar texto",
        "credentials": {}
      },
      {
        "parameters": {
          "sendTo": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('To', ``, 'string') }}",
          "subject": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Subject', ``, 'string') }}",
          "emailType": "text",
          "message": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Message', ``, 'string') }}",
          "options": {
            "appendAttribution": false
          }
        },
        "type": "n8n-nodes-base.gmailTool",
        "typeVersion": 2.1,
        "position": [
          2608,
          608
        ],
        "id": "f2d9cd52-e943-484d-b3fe-ad791681f14d",
        "name": "Send a message in Gmail",
        "webhookId": "REDACTED",
        "credentials": {}
      },
      {
        "parameters": {
          "jsCode": "let remoteJid = $('Edit Fields').first().json.chat_id;\n\nlet newValue;\nif (remoteJid === '237412974375033@lid') {\n  newValue = '56971357546@s.whatsapp.net';\n} else {\n  newValue = remoteJid;\n}\n\nreturn [{\n  json: {\n    chat_id: newValue\n  }\n}];\n"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          2688,
          208
        ],
        "id": "22441fee-1e52-4351-aa3b-e468974e2d2d",
        "name": "Code in JavaScript1"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "04868508-eb27-4b67-9dae-c883d48466d4",
                "name": "chat_id",
                "value": "={{ $json.body.data.key.remoteJid }}",
                "type": "string"
              },
              {
                "id": "48144532-1f21-4490-93e4-f6eeb2dfaa40",
                "name": "instance_name",
                "value": "={{ $json.body.instance }}",
                "type": "string"
              },
              {
                "id": "4073cc89-9702-4346-b6c2-7e619ee6f55d",
                "name": "api_key",
                "value": "[REDACTED]",
                "type": "string"
              },
              {
                "id": "a78a3578-e487-4dc4-bdc0-6e35e3df7013",
                "name": "url_server",
                "value": "={{ $json.body.server_url }}",
                "type": "string"
              },
              {
                "id": "005d7505-414e-42d0-ba75-390a2718043a",
                "name": "text",
                "value": "={{ $json.body.data.message.conversation }}",
                "type": "string"
              },
              {
                "id": "b283725a-b70b-4324-8441-b5c1622e5e55",
                "name": "sessionKey",
                "value": "={{ $json.body.data.key.remoteJid }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -448,
          288
        ],
        "id": "12773ebf-0a2e-448e-bc24-3f68bd682e5f",
        "name": "Edit Fields"
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $('Webhook1').item.json.body.data.message.audioMessage.mimetype }}",
                      "rightValue": "=audio/ogg; codecs=opus",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      },
                      "id": "be9dbcd5-0882-4ce9-9822-305865fae492"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Audio"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "6a0ec742-7f93-4ea1-af39-35d410da1c1a",
                      "leftValue": "={{ $('Webhook1').item.json.body.data.messageType }}",
                      "rightValue": "conversation",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Texto"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.2,
        "position": [
          -112,
          288
        ],
        "id": "d98ceaf5-c5f5-4c1d-abb5-896fbe99be6e",
        "name": "Switch"
      },
      {
        "parameters": {
          "resource": "audio",
          "operation": "transcribe",
          "options": {
            "language": "es"
          }
        },
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.8,
        "position": [
          112,
          64
        ],
        "id": "9ad87462-d30c-4361-a144-74b3cf8fdce8",
        "name": "Transcribir audio",
        "credentials": {},
        "notes": "los audios estan en espaÃ±ol"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "defa1545-074d-4d6a-a21f-a95c2226995f",
                "name": "mensaje",
                "value": "={{ $json.text || $('Edit Fields').item.json.textoMensaje }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          256,
          288
        ],
        "id": "d825ea8b-26b3-4a80-9fe7-1c11133f8d2a",
        "name": "Mapear mensaje"
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $json.mensaje }}",
                      "rightValue": "[null]",
                      "operator": {
                        "type": "string",
                        "operation": "notEquals"
                      },
                      "id": "ea1ce058-1302-4e81-9680-f70a12960a82"
                    }
                  ],
                  "combinator": "and"
                }
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.2,
        "position": [
          720,
          288
        ],
        "id": "48536d91-ae53-49e0-bcbf-da1d4bc10692",
        "name": "Switch1"
      },
      {
        "parameters": {
          "operation": "toBinary",
          "sourceProperty": "data.base64",
          "options": {
            "mimeType": "audio/mp3"
          }
        },
        "type": "n8n-nodes-base.convertToFile",
        "typeVersion": 1.1,
        "position": [
          -80,
          64
        ],
        "id": "fb04e604-7b55-40ce-8c75-15a2611d9e0d",
        "name": "Convert to File"
      },
      {
        "parameters": {},
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          1152,
          288
        ],
        "id": "24eaf457-aa2e-46e4-8568-2705bcee0ee1",
        "name": "Wait",
        "webhookId": "REDACTED"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "8ac5729a-0f8a-4564-b4f9-dd5e1fcb4c05",
                "leftValue": "={{ $json.message.last() }}",
                "rightValue": "={{ $('Mapear mensaje').item.json.mensaje }}",
                "operator": {
                  "type": "string",
                  "operation": "equals",
                  "name": "filter.operator.equals"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          1552,
          288
        ],
        "id": "209f32e6-9f0d-4058-9bd9-1739ea04a1bd",
        "name": "If"
      },
      {
        "parameters": {},
        "type": "n8n-nodes-base.noOp",
        "typeVersion": 1,
        "position": [
          1872,
          592
        ],
        "id": "fb8262b7-eb73-45d8-9e53-19116212bd47",
        "name": "No Operation, do nothing"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "4a46e63b-2ead-4f35-aaa2-ab4ef5fc69f2",
                "name": "response",
                "value": "={{ $('Redis1').item.json.message.join() }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          1856,
          256
        ],
        "id": "6c51b18f-8ede-4e0b-86ad-24f830980715",
        "name": "pregunta_usuario"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "641c492a-2026-49ba-81d8-31d19976fd99",
                "leftValue": "={{ $json.body.data.key.fromMe.toString() }}",
                "rightValue": "false",
                "operator": {
                  "type": "string",
                  "operation": "equals",
                  "name": "filter.operator.equals"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          -688,
          288
        ],
        "id": "a55bb5fa-dd3c-4b47-a02f-af4f381d2996",
        "name": "If1"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "62cf7f96-e1f3-4350-850c-548e2291ed79",
                "leftValue": "={{ $json.mensaje }}",
                "rightValue": "LLAMAME",
                "operator": {
                  "type": "string",
                  "operation": "equals",
                  "name": "filter.operator.equals"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          448,
          288
        ],
        "id": "ce707dac-8615-4834-872a-0ee844d4105c",
        "name": "If2"
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "abogados",
          "options": {}
        },
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2.1,
        "position": [
          -832,
          288
        ],
        "id": "6b6788a1-db3d-473a-b95b-924c5d10c0c6",
        "name": "Webhook1",
        "webhookId": "REDACTED"
      },
      {
        "parameters": {
          "operation": "push",
          "list": "={{ $('Edit Fields').item.json.chat_id }}",
          "messageData": "={{ $('Mapear mensaje').item.json.mensaje }}",
          "tail": true
        },
        "type": "n8n-nodes-base.redis",
        "typeVersion": 1,
        "position": [
          960,
          272
        ],
        "id": "ebdc2b1e-3ed9-4030-925f-ee24207e1b45",
        "name": "Redis",
        "credentials": {}
      },
      {
        "parameters": {
          "operation": "get",
          "propertyName": "message",
          "key": "={{ $('Edit Fields').item.json.chat_id }}",
          "options": {}
        },
        "type": "n8n-nodes-base.redis",
        "typeVersion": 1,
        "position": [
          1392,
          288
        ],
        "id": "f916f961-cc82-4aed-85dd-258e447a65f0",
        "name": "Redis1",
        "credentials": {}
      },
      {
        "parameters": {
          "operation": "delete",
          "key": "={{ $('Edit Fields').item.json.chat_id }}"
        },
        "type": "n8n-nodes-base.redis",
        "typeVersion": 1,
        "position": [
          2080,
          208
        ],
        "id": "69327b6e-ef93-4e00-9fa6-590d4f728a5f",
        "name": "Redis3",
        "credentials": {}
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "f7b11998-006c-40d0-869f-c67f0896d4b3",
                "name": "data.base64",
                "value": "={{ $('Webhook1').item.json.body.data.message.base64 }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -272,
          64
        ],
        "id": "7c483c4d-30d8-4430-ab3e-3a2ca2ba775a",
        "name": "Edit Fields1"
      },
      {
        "parameters": {
          "model": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4.1-mini"
          },
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1.2,
        "position": [
          2192,
          528
        ],
        "id": "ca9503c7-55af-4d5b-a778-a3b5f8a58ca0",
        "name": "OpenAI Chat Model1",
        "credentials": {}
      }
    ],
    "connections": {
      "AI Agent1": {
        "main": [
          [
            {
              "node": "Code in JavaScript1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Postgres Chat Memory": {
        "ai_memory": [
          [
            {
              "node": "AI Agent1",
              "type": "ai_memory",
              "index": 0
            }
          ]
        ]
      },
      "Embeddings OpenAI": {
        "ai_embedding": [
          [
            {
              "node": "Supabase Vector Store",
              "type": "ai_embedding",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model": {
        "ai_languageModel": [
          [
            {
              "node": "AI Agent1",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Create an event in Google Calendar": {
        "ai_tool": [
          [
            {
              "node": "AI Agent1",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Delete an event in Google Calendar": {
        "ai_tool": [
          [
            {
              "node": "AI Agent1",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Get many events in Google Calendar": {
        "ai_tool": [
          [
            {
              "node": "AI Agent1",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Send a message in Gmail": {
        "ai_tool": [
          [
            {
              "node": "AI Agent1",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Code in JavaScript1": {
        "main": [
          [
            {
              "node": "Enviar texto",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Supabase Vector Store": {
        "ai_tool": [
          [
            {
              "node": "AI Agent1",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields": {
        "main": [
          [
            {
              "node": "Switch",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Switch": {
        "main": [
          [
            {
              "node": "Edit Fields1",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Mapear mensaje",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Transcribir audio": {
        "main": [
          [
            {
              "node": "Mapear mensaje",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Mapear mensaje": {
        "main": [
          [
            {
              "node": "If2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Switch1": {
        "main": [
          [
            {
              "node": "Redis",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Convert to File": {
        "main": [
          [
            {
              "node": "Transcribir audio",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Wait": {
        "main": [
          [
            {
              "node": "Redis1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If": {
        "main": [
          [
            {
              "node": "pregunta_usuario",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "No Operation, do nothing",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "pregunta_usuario": {
        "main": [
          [
            {
              "node": "Redis3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If1": {
        "main": [
          [
            {
              "node": "Edit Fields",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If2": {
        "main": [
          [],
          [
            {
              "node": "Switch1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Webhook1": {
        "main": [
          [
            {
              "node": "If1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Redis": {
        "main": [
          [
            {
              "node": "Wait",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Redis1": {
        "main": [
          [
            {
              "node": "If",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields1": {
        "main": [
          [
            {
              "node": "Convert to File",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Redis3": {
        "main": [
          [
            {
              "node": "AI Agent1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "authors": "abdelilah  idrissi",
    "name": null,
    "description": null
  },
  "activeVersionId": "2184cd58-0956-4b78-ad91-7cae2fa3b91d",
  "connections": {
    "AI Agent1": {
      "main": [
        [
          {
            "node": "Code in JavaScript1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI": {
      "ai_embedding": [
        [
          {
            "node": "Supabase Vector Store",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Create an event in Google Calendar": {
      "ai_tool": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Delete an event in Google Calendar": {
      "ai_tool": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Get many events in Google Calendar": {
      "ai_tool": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Send a message in Gmail": {
      "ai_tool": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript1": {
      "main": [
        [
          {
            "node": "Enviar texto",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Supabase Vector Store": {
      "ai_tool": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "Edit Fields1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Mapear mensaje",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Transcribir audio": {
      "main": [
        [
          {
            "node": "Mapear mensaje",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mapear mensaje": {
      "main": [
        [
          {
            "node": "If2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch1": {
      "main": [
        [
          {
            "node": "Redis",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert to File": {
      "main": [
        [
          {
            "node": "Transcribir audio",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "Redis1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "pregunta_usuario",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation, do nothing",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "pregunta_usuario": {
      "main": [
        [
          {
            "node": "Redis3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If2": {
      "main": [
        [],
        [
          {
            "node": "Switch1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook1": {
      "main": [
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Redis": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Redis1": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields1": {
      "main": [
        [
          {
            "node": "Convert to File",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Redis3": {
      "main": [
        [
          {
            "node": "AI Agent1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-11-16T08:31:13.148Z",
  "id": "HsTwCOy1px3JEs0r",
  "isArchived": false,
  "meta": null,
  "name": "chatbot abogados",
  "nodes": [
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.response }}",
        "options": {
          "systemMessage": "=# System Prompt - Asistente Virtual Despacho de Abogados Lex & Justicia\n\nEres un asistente profesional de atenciÃ³n al cliente por WhatsApp para el **Despacho de Abogados Lex & Justicia**, ubicado en Madrid. Tu comunicaciÃ³n debe ser cordial, clara, resolutiva y adaptada al canal de mensajerÃ­a instantÃ¡nea, siempre respetando la confidencialidad y seriedad que requiere el Ã¡mbito legal.\n\nResponde de forma natural y directa, manteniendo siempre un tono amable, profesional y empÃ¡tico. Tu objetivo es ayudar al cliente, resolver dudas rÃ¡pidamente, ofrecer informaciÃ³n precisa sobre servicios legales y, cuando sea necesario, agendar consultas o derivar casos urgentes.\n\n---\n\n## ğŸ›ï¸ Nombre del despacho:\n**Despacho de Abogados Lex & Justicia**\n\n---\n\n## ğŸ“ UbicaciÃ³n:\n**Calle Mayor, 42, Madrid, EspaÃ±a**  \nCerca de la Plaza Mayor, a 5 minutos del metro Ã“pera.  \nParking pÃºblico a 3 minutos caminando.\n\n---\n\n## ğŸ•˜ Horario de atenciÃ³n:  \nLunes a viernes de 9:00h a 19:00h  \nSÃ¡bados de 10:00h a 14:00h  \nDomingos cerrado\n\n---\n\n## ğŸ“ Contacto:\nTelÃ©fono: 913 45 26 61  \nWhatsApp: 642 11 22 33  \nEmail: contacto@lexyjusticia.com\n\n---\n\n## âš–ï¸ Servicios principales y tarifas:\n\n### 1. Consultas legales\n- **Consulta inicial presencial u online**: 50â‚¬ - 80â‚¬ (30-60 minutos)\n- **Consulta telefÃ³nica breve**: 30â‚¬ (15 minutos)\n\n### 2. Derecho Civil\n\n**Divorcios:**\n- Divorcio de mutuo acuerdo (express): 400â‚¬ - 600â‚¬\n- Divorcio contencioso: 1.200â‚¬ - 2.500â‚¬\n- ModificaciÃ³n de medidas: 500â‚¬ - 900â‚¬\n\n**Herencias:**\n- TramitaciÃ³n de herencia simple: 800â‚¬ - 1.500â‚¬\n- Herencia con conflicto: 1.500â‚¬ - 3.500â‚¬\n- RedacciÃ³n de testamento: 150â‚¬ - 300â‚¬\n\n**Contratos:**\n- RevisiÃ³n de contrato: 150â‚¬ - 300â‚¬\n- RedacciÃ³n de contrato personalizado: 250â‚¬ - 600â‚¬\n- NegociaciÃ³n contractual: 400â‚¬ - 1.000â‚¬\n\n**Reclamaciones de cantidad:**\n- Juicio monitorio: 300â‚¬ - 600â‚¬\n- ReclamaciÃ³n judicial: 500â‚¬ - 1.500â‚¬\n\n### 3. Derecho Penal\n\n- **Asistencia al detenido (urgente)**: 400â‚¬ - 800â‚¬\n- **Defensa en juicio rÃ¡pido**: 600â‚¬ - 1.200â‚¬\n- **Defensa penal (delito leve)**: 1.000â‚¬ - 2.500â‚¬\n- **Defensa penal (delito grave)**: 2.500â‚¬ - 6.000â‚¬\n- **Recurso de apelaciÃ³n penal**: 800â‚¬ - 1.800â‚¬\n\n### 4. Derecho Laboral\n\n- **Despido improcedente**: 600â‚¬ - 1.200â‚¬ (mÃ¡s % de indemnizaciÃ³n)\n- **ReclamaciÃ³n de cantidad (nÃ³minas, finiquito)**: 400â‚¬ - 900â‚¬\n- **ERE (Expediente de RegulaciÃ³n de Empleo)**: 800â‚¬ - 1.800â‚¬\n- **Incapacidad laboral**: 700â‚¬ - 1.500â‚¬\n- **ModificaciÃ³n sustancial de condiciones**: 500â‚¬ - 1.000â‚¬\n\n### 5. Derecho Inmobiliario\n\n- **Contrato de alquiler (redacciÃ³n)**: 200â‚¬ - 400â‚¬\n- **Contrato de arras**: 250â‚¬ - 500â‚¬\n- **Compraventa de inmueble**: 600â‚¬ - 1.200â‚¬\n- **Desahucio por impago**: 600â‚¬ - 1.200â‚¬\n- **ReclamaciÃ³n de fianza**: 300â‚¬ - 600â‚¬\n\n### 6. Derecho Mercantil\n\n- **ConstituciÃ³n de sociedad (SL o SA)**: 800â‚¬ - 1.500â‚¬\n- **ModificaciÃ³n estatutos sociales**: 400â‚¬ - 800â‚¬\n- **AsesorÃ­a empresarial mensual**: 200â‚¬ - 500â‚¬/mes\n- **DisoluciÃ³n de sociedad**: 700â‚¬ - 1.400â‚¬\n- **Conflictos entre socios**: 1.000â‚¬ - 2.500â‚¬\n\n### 7. MediaciÃ³n y resoluciÃ³n de conflictos\n\n- **SesiÃ³n de mediaciÃ³n (por sesiÃ³n)**: 150â‚¬ - 300â‚¬\n- **Proceso de mediaciÃ³n completo**: 600â‚¬ - 1.500â‚¬\n\n### 8. RedacciÃ³n de documentos legales personalizados\n\n- **ReclamaciÃ³n extrajudicial (burofax)**: 80â‚¬ - 150â‚¬\n- **Demanda judicial**: 300â‚¬ - 800â‚¬\n- **Recurso administrativo**: 250â‚¬ - 600â‚¬\n- **Alegaciones**: 150â‚¬ - 400â‚¬\n- **Escritos judiciales**: 100â‚¬ - 300â‚¬\n\n---\n\n## ğŸ’° MÃ©todos de pago:\n\n**Formas de pago aceptadas:**\n- Efectivo\n- Tarjetas de crÃ©dito y dÃ©bito\n- Transferencia bancaria\n- Bizum\n- **FinanciaciÃ³n en cuotas mensuales sin intereses** (casos superiores a 500â‚¬, hasta 12 meses)\n\n---\n\n## ğŸš¨ AtenciÃ³n a casos urgentes:\n\n- AtenciÃ³n de urgencias legales durante el horario laboral\n- **Guardias 24 horas** para urgencias penales (asistencia al detenido)\n- NÃºmero de emergencias penales 24h: +34 666 789 012\n- Los casos urgentes se priorizan y se asignan al abogado mÃ¡s adecuado\n\n---\n\n## ğŸ“… PolÃ­tica de citas:\n\n- **Todas las consultas requieren cita previa**\n- Recordatorios automÃ¡ticos por WhatsApp y email 24h y 2h antes de la cita\n- Cancelaciones con mÃ­nimo 24 horas de antelaciÃ³n\n- Reprogramaciones por telÃ©fono o WhatsApp\n\n---\n\n## ğŸ”’ PolÃ­tica de privacidad:\n\nLos datos personales se utilizan Ãºnicamente para fines administrativos, legales y de contacto.  \nSe cumple estrictamente con la normativa europea GDPR.  \nLa informaciÃ³n del cliente se guarda de forma segura y no se comparte sin autorizaciÃ³n expresa.\n\n---\n\n## ğŸ“‹ Proceso para agendar una cita:\n\n### Paso 1: Identificar la necesidad\nPregunta al cliente sobre el Ã¡rea legal de su consulta para asignar al abogado especializado:\n- \"Â¿En quÃ© Ã¡rea legal necesitas asesoramiento? Por ejemplo: divorcio, herencia, despido, penal, contratos, etc.\"\n\n### Paso 2: Preguntar fecha y hora preferida\n- \"Â¿Para quÃ© dÃ­a y hora te gustarÃ­a agendar tu consulta?\"\n\n### Paso 3: Confirmar disponibilidad\n- Indica que hay disponibilidad y que necesitas algunos datos para continuar.\n\n### Paso 4: Solicitar datos uno por uno\n\nPide los datos **uno por uno** y **espera respuesta tras cada uno**:\n\n1. \"Perfecto, para agendar tu consulta, Â¿me puedes indicar tu **nombre completo**, por favor?\"\n   *(Esperar respuesta)*\n\n2. \"Gracias, Â¿me das ahora tu **nÃºmero de telÃ©fono**?\"\n   *(Esperar respuesta)*\n   > âš ï¸ No es necesario pedir el prefijo +34, se asume por defecto.\n\n3. \"Y por Ãºltimo, Â¿tu **correo electrÃ³nico**?\"\n   *(Esperar respuesta)*\n   > ğŸ“Œ Si el cliente no tiene o no quiere dar email, continÃºa sin Ã©l.\n\n4. \"Â¿Prefieres la consulta **presencial** en nuestro despacho o **online** por videollamada?\"\n   *(Esperar respuesta)*\n\n### Paso 5: Agendar la cita\n\nUtiliza la herramienta de agendamiento con los datos recopilados.\n\n- Si **no se pudo reservar**, informa del error amablemente y ofrece alternativas:\n  > \"Lo siento, ese horario no estÃ¡ disponible. Â¿Te vendrÃ­a bien el [fecha alternativa] a las [hora]?\"\n\n- Si **la reserva fue exitosa**, continÃºa al paso 6.\n\n### Paso 6: ConfirmaciÃ³n\n\nConfirma la cita con todos los detalles:\n\n> \"âœ… **Consulta agendada con Ã©xito**\n> \n> ğŸ“… Fecha: [DÃA/MES/AÃ‘O]  \n> ğŸ• Hora: [HORA]  \n> ğŸ“ Modalidad: [Presencial/Online]  \n> âš–ï¸ Ãrea: [Derecho Civil/Penal/etc.]\n> \n> RecibirÃ¡s recordatorios automÃ¡ticos 24h y 2h antes de tu cita.  \n> Si necesitas cancelar o reprogramar, avÃ­sanos con al menos 24 horas de antelaciÃ³n.\n> \n> Â¿Necesitas algo mÃ¡s?\"\n\n- Si **no necesita nada mÃ¡s**, despÃ­dete cordialmente:\n  > \"Perfecto, te esperamos. Si tienes cualquier duda antes de la consulta, no dudes en escribirnos. Â¡Que tengas un buen dÃ­a!\"\n\n- Si **necesita algo mÃ¡s**, responde usando la base de conocimientos.\n- En el caso de que te dio su email mandale un aviso de su cita por email usando esta tool 'Send a message in Gmail'\n---\n\n## ğŸ’¡ Preguntas frecuentes a manejar:\n\n**P: Â¿La primera consulta es gratuita?**  \nR: No, la primera consulta informativa tiene un coste de 50â‚¬ a 80â‚¬ segÃºn el Ã¡rea legal (30-60 minutos).\n\n**P: Â¿CuÃ¡nto cuesta un divorcio?**  \nR: Un divorcio de mutuo acuerdo tiene un precio desde 400â‚¬. Los divorcios contenciosos van desde 1.200â‚¬ hasta 2.500â‚¬ segÃºn la complejidad.\n\n**P: Â¿CuÃ¡nto cobran por un despido?**  \nR: La defensa en un despido improcedente tiene un coste de 600â‚¬ a 1.200â‚¬, mÃ¡s un porcentaje sobre la indemnizaciÃ³n obtenida.\n\n**P: Â¿Atienden a empresas?**  \nR: SÃ­, atendemos tanto a empresas como a particulares. Ofrecemos asesorÃ­a empresarial mensual desde 200â‚¬/mes.\n\n**P: Â¿Hacen consultas online?**  \nR: SÃ­, ofrecemos asistencia jurÃ­dica online por videollamada para clientes dentro y fuera de Madrid.\n\n**P: Â¿Tienen disponibilidad inmediata?**  \nR: Para casos urgentes, tenemos disponibilidad durante el horario laboral. Para urgencias penales contamos con guardias 24 horas.\n\n**P: Â¿Ofrecen financiaciÃ³n?**  \nR: SÃ­, ofrecemos financiaciÃ³n sin intereses en cuotas mensuales para casos superiores a 500â‚¬ (hasta 12 meses).\n\n---\n\n## ğŸ¯ Tono y estilo de comunicaciÃ³n:\n\n- **EmpÃ¡tico y cercano**, pero siempre profesional\n- **Confidencial**: nunca solicites detalles sensibles del caso por WhatsApp\n- **Claro y conciso**: mensajes breves adaptados a WhatsApp\n- **Resolutivo**: busca siempre ofrecer una soluciÃ³n o siguiente paso\n- **Sin emojis excesivos**: usa solo los necesarios para humanizar (âœ…ğŸ“…ğŸ•ğŸ“âš–ï¸)\n\n---\n\n## âš ï¸ Importante:\n\n- **No des asesoramiento legal especÃ­fico** por WhatsApp. Para consultas legales concretas, agenda una cita con el abogado.\n- **No solicites detalles sensibles del caso** por este canal. Solo informaciÃ³n bÃ¡sica para el agendamiento.\n- **MantÃ©n la confidencialidad** en todo momento.\n- Si el cliente tiene una urgencia penal seria (detenido), facilita el nÃºmero de emergencia del despacho: +34 666 789 012\n- **Los precios son orientativos** y pueden variar segÃºn la complejidad del caso. Siempre menciona \"desde\" cuando des rangos de precio.\n\n---\n\n**Fecha de hoy:** {{ $json.fechaActual }}\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.9,
      "position": [
        2336,
        208
      ],
      "id": "3e46e1ee-edb9-42d7-a3a6-cdb51f61d65a",
      "name": "AI Agent1"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Edit Fields').item.json.sessionKey }}",
        "tableName": "n8n_chat_histories_abogados"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        2400,
        608
      ],
      "id": "3e14671f-97c5-4a2a-9be9-f46a0cf73400",
      "name": "Postgres Chat Memory",
      "credentials": {}
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolDescription": "aqui sacas info sobre los servicios, ubicacion y otros datos.",
        "tableName": {
          "__rl": true,
          "value": "documents",
          "mode": "list",
          "cachedResultName": "documents"
        },
        "topK": 50,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        2416,
        784
      ],
      "id": "8b65ef26-fb13-46ca-a249-f6b8e28f1927",
      "name": "Supabase Vector Store",
      "credentials": {}
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        2336,
        912
      ],
      "id": "7a6547c1-a79f-42ac-b9f7-d937b47aaaa6",
      "name": "Embeddings OpenAI",
      "credentials": {}
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        2288,
        432
      ],
      "id": "92229a8e-176e-44b3-831b-f821555afa24",
      "name": "OpenAI Chat Model",
      "credentials": {}
    },
    {
      "parameters": {
        "calendar": {
          "__rl": true,
          "value": "aimaspain.contacto@gmail.com",
          "mode": "list",
          "cachedResultName": "aimaspain.contacto@gmail.com"
        },
        "start": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Start', ``, 'string') }}",
        "end": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('End', ``, 'string') }}",
        "useDefaultReminders": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Use_Default_Reminders', ``, 'boolean') }}",
        "additionalFields": {
          "attendees": [
            "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('attendees0_Attendees', ``, 'string') }}",
            "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('attendees1_Attendees', ``, 'string') }}"
          ],
          "description": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Description', ``, 'string') }}"
        }
      },
      "type": "n8n-nodes-base.googleCalendarTool",
      "typeVersion": 1.3,
      "position": [
        3056,
        608
      ],
      "id": "c0dbbfe3-8522-4286-a3bf-03a61e332776",
      "name": "Create an event in Google Calendar",
      "credentials": {}
    },
    {
      "parameters": {
        "operation": "delete",
        "calendar": {
          "__rl": true,
          "value": "aimaspain.contacto@gmail.com",
          "mode": "list",
          "cachedResultName": "aimaspain.contacto@gmail.com"
        },
        "eventId": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Event_ID', ``, 'string') }}",
        "options": {}
      },
      "type": "n8n-nodes-base.googleCalendarTool",
      "typeVersion": 1.3,
      "position": [
        2912,
        608
      ],
      "id": "97518eb3-53da-43e7-8946-5d362107c5b1",
      "name": "Delete an event in Google Calendar",
      "credentials": {}
    },
    {
      "parameters": {
        "operation": "getAll",
        "calendar": {
          "__rl": true,
          "value": "aimaspain.contacto@gmail.com",
          "mode": "list",
          "cachedResultName": "aimaspain.contacto@gmail.com"
        },
        "returnAll": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Return_All', ``, 'boolean') }}",
        "timeMin": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('After', ``, 'string') }}",
        "timeMax": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Before', ``, 'string') }}",
        "options": {}
      },
      "type": "n8n-nodes-base.googleCalendarTool",
      "typeVersion": 1.3,
      "position": [
        2768,
        608
      ],
      "id": "677ff477-c7c9-45a1-a6ff-46439523a57e",
      "name": "Get many events in Google Calendar",
      "credentials": {}
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "demo whatsap",
        "remoteJid": "={{ $json.chat_id }}",
        "messageText": "={{ $('AI Agent1').item.json.output }}",
        "options_message": {
          "delay": 1000
        }
      },
      "type": "n8n-nodes-evolution-api.evolutionApi",
      "typeVersion": 1,
      "position": [
        2848,
        208
      ],
      "id": "6f76027b-3c15-473f-b7d7-e430947214ff",
      "name": "Enviar texto",
      "credentials": {}
    },
    {
      "parameters": {
        "sendTo": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('To', ``, 'string') }}",
        "subject": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Subject', ``, 'string') }}",
        "emailType": "text",
        "message": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Message', ``, 'string') }}",
        "options": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.gmailTool",
      "typeVersion": 2.1,
      "position": [
        2608,
        608
      ],
      "id": "f2d9cd52-e943-484d-b3fe-ad791681f14d",
      "name": "Send a message in Gmail",
      "webhookId": "REDACTED",
      "credentials": {}
    },
    {
      "parameters": {
        "jsCode": "let remoteJid = $('Edit Fields').first().json.chat_id;\n\nlet newValue;\nif (remoteJid === '237412974375033@lid') {\n  newValue = '56971357546@s.whatsapp.net';\n} else {\n  newValue = remoteJid;\n}\n\nreturn [{\n  json: {\n    chat_id: newValue\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2688,
        208
      ],
      "id": "22441fee-1e52-4351-aa3b-e468974e2d2d",
      "name": "Code in JavaScript1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "04868508-eb27-4b67-9dae-c883d48466d4",
              "name": "chat_id",
              "value": "={{ $json.body.data.key.remoteJid }}",
              "type": "string"
            },
            {
              "id": "48144532-1f21-4490-93e4-f6eeb2dfaa40",
              "name": "instance_name",
              "value": "={{ $json.body.instance }}",
              "type": "string"
            },
            {
              "id": "4073cc89-9702-4346-b6c2-7e619ee6f55d",
              "name": "api_key",
              "value": "[REDACTED]",
              "type": "string"
            },
            {
              "id": "a78a3578-e487-4dc4-bdc0-6e35e3df7013",
              "name": "url_server",
              "value": "={{ $json.body.server_url }}",
              "type": "string"
            },
            {
              "id": "005d7505-414e-42d0-ba75-390a2718043a",
              "name": "text",
              "value": "={{ $json.body.data.message.conversation }}",
              "type": "string"
            },
            {
              "id": "b283725a-b70b-4324-8441-b5c1622e5e55",
              "name": "sessionKey",
              "value": "={{ $json.body.data.key.remoteJid }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -448,
        288
      ],
      "id": "12773ebf-0a2e-448e-bc24-3f68bd682e5f",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Webhook1').item.json.body.data.message.audioMessage.mimetype }}",
                    "rightValue": "=audio/ogg; codecs=opus",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "be9dbcd5-0882-4ce9-9822-305865fae492"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Audio"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "6a0ec742-7f93-4ea1-af39-35d410da1c1a",
                    "leftValue": "={{ $('Webhook1').item.json.body.data.messageType }}",
                    "rightValue": "conversation",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Texto"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -112,
        288
      ],
      "id": "d98ceaf5-c5f5-4c1d-abb5-896fbe99be6e",
      "name": "Switch"
    },
    {
      "parameters": {
        "resource": "audio",
        "operation": "transcribe",
        "options": {
          "language": "es"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.8,
      "position": [
        112,
        64
      ],
      "id": "9ad87462-d30c-4361-a144-74b3cf8fdce8",
      "name": "Transcribir audio",
      "credentials": {},
      "notes": "los audios estan en espaÃ±ol"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "defa1545-074d-4d6a-a21f-a95c2226995f",
              "name": "mensaje",
              "value": "={{ $json.text || $('Edit Fields').item.json.textoMensaje }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        256,
        288
      ],
      "id": "d825ea8b-26b3-4a80-9fe7-1c11133f8d2a",
      "name": "Mapear mensaje"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.mensaje }}",
                    "rightValue": "[null]",
                    "operator": {
                      "type": "string",
                      "operation": "notEquals"
                    },
                    "id": "ea1ce058-1302-4e81-9680-f70a12960a82"
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        720,
        288
      ],
      "id": "48536d91-ae53-49e0-bcbf-da1d4bc10692",
      "name": "Switch1"
    },
    {
      "parameters": {
        "operation": "toBinary",
        "sourceProperty": "data.base64",
        "options": {
          "mimeType": "audio/mp3"
        }
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        -80,
        64
      ],
      "id": "fb04e604-7b55-40ce-8c75-15a2611d9e0d",
      "name": "Convert to File"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        1152,
        288
      ],
      "id": "24eaf457-aa2e-46e4-8568-2705bcee0ee1",
      "name": "Wait",
      "webhookId": "REDACTED"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "8ac5729a-0f8a-4564-b4f9-dd5e1fcb4c05",
              "leftValue": "={{ $json.message.last() }}",
              "rightValue": "={{ $('Mapear mensaje').item.json.mensaje }}",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1552,
        288
      ],
      "id": "209f32e6-9f0d-4058-9bd9-1739ea04a1bd",
      "name": "If"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        1872,
        592
      ],
      "id": "fb8262b7-eb73-45d8-9e53-19116212bd47",
      "name": "No Operation, do nothing"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "4a46e63b-2ead-4f35-aaa2-ab4ef5fc69f2",
              "name": "response",
              "value": "={{ $('Redis1').item.json.message.join() }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1856,
        256
      ],
      "id": "6c51b18f-8ede-4e0b-86ad-24f830980715",
      "name": "pregunta_usuario"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "641c492a-2026-49ba-81d8-31d19976fd99",
              "leftValue": "={{ $json.body.data.key.fromMe.toString() }}",
              "rightValue": "false",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -688,
        288
      ],
      "id": "a55bb5fa-dd3c-4b47-a02f-af4f381d2996",
      "name": "If1"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "62cf7f96-e1f3-4350-850c-548e2291ed79",
              "leftValue": "={{ $json.mensaje }}",
              "rightValue": "LLAMAME",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        448,
        288
      ],
      "id": "ce707dac-8615-4834-872a-0ee844d4105c",
      "name": "If2"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "abogados",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -832,
        288
      ],
      "id": "6b6788a1-db3d-473a-b95b-924c5d10c0c6",
      "name": "Webhook1",
      "webhookId": "REDACTED"
    },
    {
      "parameters": {
        "operation": "push",
        "list": "={{ $('Edit Fields').item.json.chat_id }}",
        "messageData": "={{ $('Mapear mensaje').item.json.mensaje }}",
        "tail": true
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        960,
        272
      ],
      "id": "ebdc2b1e-3ed9-4030-925f-ee24207e1b45",
      "name": "Redis",
      "credentials": {}
    },
    {
      "parameters": {
        "operation": "get",
        "propertyName": "message",
        "key": "={{ $('Edit Fields').item.json.chat_id }}",
        "options": {}
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        1392,
        288
      ],
      "id": "f916f961-cc82-4aed-85dd-258e447a65f0",
      "name": "Redis1",
      "credentials": {}
    },
    {
      "parameters": {
        "operation": "delete",
        "key": "={{ $('Edit Fields').item.json.chat_id }}"
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        2080,
        208
      ],
      "id": "69327b6e-ef93-4e00-9fa6-590d4f728a5f",
      "name": "Redis3",
      "credentials": {}
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "f7b11998-006c-40d0-869f-c67f0896d4b3",
              "name": "data.base64",
              "value": "={{ $('Webhook1').item.json.body.data.message.base64 }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -272,
        64
      ],
      "id": "7c483c4d-30d8-4430-ab3e-3a2ca2ba775a",
      "name": "Edit Fields1"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        2192,
        528
      ],
      "id": "ca9503c7-55af-4d5b-a778-a3b5f8a58ca0",
      "name": "OpenAI Chat Model1",
      "credentials": {}
    }
  ],
  "origin": "n8n",
  "pinData": {
    "Webhook1": [
      {
        "json": {
          "headers": {
            "host": "personal-n8n.rk9l1c.easypanel.host",
            "user-agent": "axios/1.7.9",
            "content-length": "1065",
            "accept-encoding": "gzip, compress, deflate, br",
            "content-type": "application/json",
            "x-forwarded-for": "172.18.0.1",
            "x-forwarded-host": "personal-n8n.rk9l1c.easypanel.host",
            "x-forwarded-port": "443",
            "x-forwarded-proto": "https",
            "x-forwarded-server": "227e2e43f3cd",
            "x-real-ip": "172.18.0.1"
          },
          "params": {},
          "query": {},
          "body": {
            "event": "messages.upsert",
            "instance": "demo whatsap",
            "data": {
              "key": {
                "remoteJid": "34612575083@s.whatsapp.net",
                "fromMe": false,
                "id": "AC1C7583E99BAFADF5FBD5A254F64BB2"
              },
              "pushName": "Abde",
              "status": "DELIVERY_ACK",
              "message": {
                "messageContextInfo": {
                  "deviceListMetadata": {
                    "senderKeyHash": "7kMPy0IsLbcR+A==",
                    "senderTimestamp": "1763720164",
                    "recipientKeyHash": "DR2kVJHVntzmTQ==",
                    "recipientTimestamp": "1764181668"
                  },
                  "deviceListMetadataVersion": 2,
                  "messageSecret": "/iupwIRq8s8MeZK6WBFw9nuoIz/d/T8dnEbSTIT27q4="
                },
                "conversation": "Hola"
              },
              "contextInfo": {
                "entryPointConversionSource": "global_search_new_chat",
                "entryPointConversionApp": "whatsapp",
                "entryPointConversionDelaySeconds": 50805
              },
              "messageType": "conversation",
              "messageTimestamp": 1764930943,
              "instanceId": "2a0d9865-759f-4e6b-8e42-4ccaa9fd2d56",
              "source": "android"
            },
            "destination": "https://personal-n8n.rk9l1c.easypanel.host/webhook/abogados",
            "date_time": "2025-12-05T07:35:43.556Z",
            "sender": "34641750559@s.whatsapp.net",
            "server_url": "https://personal-evolution-api.rk9l1c.easypanel.host",
            "apikey": "341DA03A8BB5-4F67-9135-BECA8A83EC55"
          },
          "webhookUrl": "https://personal-n8n.rk9l1c.easypanel.host/webhook/abogados",
          "executionMode": "production"
        }
      }
    ]
  },
  "repo": {
    "owner": "abdeidr",
    "name": "n8n"
  },
  "settings": {
    "executionOrder": "v1"
  },
  "shared": [
    {
      "updatedAt": "2025-11-16T08:31:13.157Z",
      "createdAt": "2025-11-16T08:31:13.157Z",
      "role": "workflow:owner",
      "workflowId": "HsTwCOy1px3JEs0r",
      "projectId": "xdZYvePgLSibegaD"
    }
  ],
  "staticData": null,
  "tags": [],
  "triggerCount": 1,
  "updatedAt": "2025-12-05T10:38:09.000Z",
  "versionId": "2184cd58-0956-4b78-ad91-7cae2fa3b91d"
}